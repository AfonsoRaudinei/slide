<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Linkren Presentation Studio</title>

  <!-- PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- PPT export (opcional, j√° pronto) -->
  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: #F3F4F6;
      overflow-x: hidden;
    }

    /* HEADER */
    .header {
      background: white;
      padding: 20px 40px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
    }
    .logo {
      font-size: 22px;
      font-weight: 900;
      color: #4ADE80;
      letter-spacing: 0.5px;
      user-select: none;
    }
    .header-actions { display: flex; align-items: center; flex-wrap: wrap; gap: 10px; }

    .btn {
      padding: 12px 16px;
      background: #4ADE80;
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      font-size: 14px;
      transition: transform 0.06s ease, background 0.15s ease;
    }
    .btn:hover { background: #3BC66F; }
    .btn:active { transform: translateY(1px); }

    .btn-secondary {
      background: #E5E7EB;
      color: #111827;
    }
    .btn-secondary:hover { background: #D1D5DB; }

    /* LAYOUT */
    .main-container {
      display: grid;
      grid-template-columns: 320px 1fr;
      height: calc(100vh - 84px);
    }

    /* SIDEBAR */
    .sidebar {
      background: white;
      padding: 20px;
      overflow-y: auto;
      border-right: 1px solid #E5E7EB;
    }
    .section { margin-bottom: 22px; }
    .section-title {
      font-size: 12px;
      font-weight: 800;
      color: #6B7280;
      text-transform: uppercase;
      letter-spacing: 1.4px;
      margin-bottom: 12px;
    }

    .theme-btn {
      width: 100%;
      padding: 12px 14px;
      margin-bottom: 10px;
      background: #F3F4F6;
      border: 1px solid transparent;
      border-radius: 12px;
      text-align: left;
      font-weight: 700;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s;
    }
    .theme-btn:hover { background: #ECFDF5; }
    .theme-btn.active {
      background: #4ADE80;
      color: white;
      border-color: #22C55E;
    }

    .component-item {
      background: white;
      border: 1px dashed #D1D5DB;
      padding: 14px;
      margin-bottom: 10px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.15s;
    }
    .component-item:hover {
      border-color: #4ADE80;
      background: #F0FDF4;
      transform: translateY(-1px);
    }
    .component-icon { font-size: 22px; margin-bottom: 6px; }
    .component-name { font-weight: 800; font-size: 13px; color: #111827; }

    /* PROPERTIES PANEL */
    .panel {
      border: 1px solid #E5E7EB;
      background: #FFFFFF;
      border-radius: 14px;
      padding: 14px;
    }
    .panel-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .panel-badge {
      font-size: 12px;
      font-weight: 800;
      color: #111827;
    }
    .panel-actions { display: flex; gap: 8px; }
    .icon-btn {
      width: 34px;
      height: 34px;
      border-radius: 10px;
      border: 1px solid #E5E7EB;
      background: #F9FAFB;
      cursor: pointer;
      font-weight: 900;
      color: #111827;
      transition: background 0.15s, transform 0.06s;
    }
    .icon-btn:hover { background: #F3F4F6; }
    .icon-btn:active { transform: translateY(1px); }

    .field { margin-top: 10px; }
    .field label {
      display: block;
      font-size: 12px;
      font-weight: 800;
      color: #6B7280;
      margin-bottom: 6px;
      letter-spacing: 0.4px;
      text-transform: uppercase;
    }
    .input, .textarea {
      width: 100%;
      border: 1px solid #E5E7EB;
      background: #FFFFFF;
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 14px;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s;
    }
    .input:focus, .textarea:focus {
      border-color: #4ADE80;
      box-shadow: 0 0 0 4px rgba(74,222,128,0.15);
    }
    .textarea { min-height: 92px; resize: vertical; }

    .muted {
      font-size: 12px;
      color: #6B7280;
      line-height: 1.6;
    }

    /* PREVIEW AREA */
    .preview-area {
      background: linear-gradient(135deg, #0F172A, #1E293B);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 36px;
      position: relative;
    }
    .preview-label {
      position: absolute;
      top: 14px;
      left: 50%;
      transform: translateX(-50%);
      color: rgba(255,255,255,0.55);
      font-size: 11px;
      font-weight: 800;
      letter-spacing: 2px;
      user-select: none;
    }

    .slide {
      width: 1000px;
      min-height: 700px;
      background: white;
      border-radius: 22px;
      padding: 56px;
      box-shadow: 0 40px 100px rgba(0,0,0,0.5);
      position: relative;
    }

    /* BLOCK WRAPPER (selection) */
    .block {
      position: relative;
      border-radius: 16px;
      transition: box-shadow 0.12s ease, outline 0.12s ease, transform 0.06s ease;
      cursor: pointer;
    }
    .block:hover { transform: translateY(-1px); }
    .block.selected {
      outline: 2px solid #4ADE80;
      box-shadow: 0 0 0 6px rgba(74,222,128,0.12);
    }

    /* COMPONENTS VISUALS (mantidos do teu estilo, s√≥ levemente afinados) */
    .hero { text-align: center; padding: 34px 0; margin-bottom: 28px; }
    .hero h1 {
      font-size: 56px;
      font-weight: 900;
      margin-bottom: 14px;
      letter-spacing: -1.6px;
      line-height: 1.08;
      color: #111827;
    }
    .hero p { font-size: 20px; color: #6B7280; font-weight: 600; }

    .cards {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 26px;
      margin-bottom: 28px;
    }
    .card {
      background: linear-gradient(135deg, #4ADE80, #22C55E);
      color: white;
      padding: 40px 30px;
      border-radius: 20px;
      text-align: center;
    }
    .card h2 { font-size: 32px; font-weight: 900; margin-bottom: 10px; }
    .card p { font-size: 16px; opacity: 0.96; font-weight: 600; }
    .card.gray { background: linear-gradient(135deg, #6B7280, #4B5563); }

    .list-section { margin-bottom: 28px; }
    .list-section h2 {
      font-size: 36px;
      font-weight: 900;
      margin-bottom: 18px;
      color: #111827;
      letter-spacing: -0.8px;
    }
    .list-section ul { padding-left: 20px; }
    .list-section li {
      margin-bottom: 10px;
      font-size: 16px;
      line-height: 1.6;
      color: #374151;
      font-weight: 600;
    }

    .quote {
      background: #1E3A2F;
      color: white;
      padding: 44px;
      border-radius: 22px;
      text-align: center;
    }
    .quote blockquote {
      font-size: 28px;
      font-weight: 800;
      line-height: 1.35;
      margin-bottom: 16px;
    }
    .quote cite { font-size: 15px; opacity: 0.9; font-weight: 700; }

    /* THEMES (data-driven; aqui s√≥ estilo visual do preview) */
    .theme-dark .slide { background: #0A0A0A; color: white; }
    .theme-dark .hero h1, .theme-dark .list-section h2 { color: white; }
    .theme-dark .hero p, .theme-dark .list-section li { color: rgba(255,255,255,0.75); }

    .theme-minimal .slide { background: white; }
    .theme-gradient .slide { background: linear-gradient(135deg, #D1FAE5, white); }

    /* EMPTY STATE */
    .empty {
      border: 1px dashed rgba(17,24,39,0.25);
      border-radius: 18px;
      padding: 26px;
      text-align: center;
      color: #374151;
      background: rgba(243,244,246,0.6);
    }
    .empty h3 { font-size: 18px; font-weight: 900; margin-bottom: 8px; color: #111827; }
    .empty p { font-size: 13px; color: #6B7280; font-weight: 600; }

    /* LOADING */
    .loading {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .loading.active { display: flex; }

    .spinner {
      width: 58px;
      height: 58px;
      border: 5px solid rgba(74,222,128,0.25);
      border-top-color: #4ADE80;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>

<body>
  <div class="loading" id="loading">
    <div class="spinner"></div>
  </div>

  <header class="header">
    <div class="logo">LINKREN STUDIO</div>
    <div class="header-actions">
      <button class="btn btn-secondary" onclick="clearAll()">üóëÔ∏è Limpar</button>
      <button class="btn btn-secondary" onclick="saveProjectManual()">üíæ Salvar</button>
      <button class="btn btn-secondary" onclick="exportPPTFromData()">üìä Exportar PPT</button>
      <button class="btn" onclick="exportPDF()">üìÑ Exportar PDF</button>
    </div>
  </header>

  <div class="main-container">
    <aside class="sidebar">
      <div class="section" id="propertiesSection">
        <h3 class="section-title">Propriedades</h3>
        <div class="panel">
          <div class="muted">
            Selecione um bloco no preview para editar aqui.
          </div>
        </div>
      </div>

      <div class="section">
        <h3 class="section-title">Temas</h3>
        <button class="theme-btn" data-theme="default" onclick="changeTheme('default', this)">üé® Avenue (Padr√£o)</button>
        <button class="theme-btn" data-theme="dark" onclick="changeTheme('dark', this)">‚ö´ Dark Mode</button>
        <button class="theme-btn" data-theme="minimal" onclick="changeTheme('minimal', this)">‚ö™ Minimal</button>
        <button class="theme-btn" data-theme="gradient" onclick="changeTheme('gradient', this)">üåà Gradient</button>
      </div>

      <div class="section">
        <h3 class="section-title">Componentes</h3>

        <div class="component-item" onclick="addHero()">
          <div class="component-icon">üì∞</div>
          <div class="component-name">Hero Title</div>
        </div>

        <div class="component-item" onclick="addCards()">
          <div class="component-icon">üìä</div>
          <div class="component-name">Two Cards</div>
        </div>

        <div class="component-item" onclick="addList()">
          <div class="component-icon">üìù</div>
          <div class="component-name">Lista</div>
        </div>

        <div class="component-item" onclick="addQuote()">
          <div class="component-icon">üí¨</div>
          <div class="component-name">Quote Box</div>
        </div>
      </div>

      <div class="section">
        <h3 class="section-title">Dica</h3>
        <p class="muted">
          O preview √© s√≥ visualiza√ß√£o. A edi√ß√£o √© feita no painel ‚ÄúPropriedades‚Äù.
        </p>
      </div>
    </aside>

    <main class="preview-area" id="previewRoot">
      <div class="preview-label">‚ú® PREVIEW EM TEMPO REAL ‚Äî CLIQUE NO BLOCO PARA EDITAR</div>
      <div class="slide theme-default" id="slide"></div>
    </main>
  </div>

  <script>
    // =========================
    // STATE (single source of truth)
    // =========================
    const STORAGE_KEY = "linkren_project_v1";

    let project = {
      version: "1.0",
      theme: "default",
      blocks: [],
      selectedBlockId: null,
      updatedAt: null
    };

    // =========================
    // STORAGE
    // =========================
    function saveProject() {
      project.updatedAt = new Date().toISOString();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(project));
    }

    function saveProjectManual() {
      saveProject();
      alert("‚úÖ Projeto salvo!");
    }

    function loadProject() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (!saved) return;
      try {
        const parsed = JSON.parse(saved);
        if (parsed && parsed.version === "1.0" && Array.isArray(parsed.blocks)) {
          project = { ...project, ...parsed };
        }
      } catch (e) {
        // se corromper, ignora e segue
      }
    }

    // =========================
    // HELPERS
    // =========================
    function uuid() {
      if (crypto && crypto.randomUUID) return crypto.randomUUID();
      return "id-" + Math.random().toString(16).slice(2) + "-" + Date.now();
    }

    function createBlock(type, data) {
      return { id: uuid(), type, data };
    }

    function getSelectedBlock() {
      return project.blocks.find(b => b.id === project.selectedBlockId) || null;
    }

    function setSelectedBlock(id) {
      project.selectedBlockId = id;
      saveProject();
      renderSlide();
      renderPropertiesPanel();
    }

    // =========================
    // THEME
    // =========================
    function changeTheme(theme, btnEl) {
      project.theme = theme;
      saveProject();
      syncThemeUI(btnEl);
      renderSlide();
    }

    function syncThemeUI(btnEl) {
      document.querySelectorAll(".theme-btn").forEach(b => b.classList.remove("active"));
      if (btnEl) btnEl.classList.add("active");

      const slide = document.getElementById("slide");
      slide.className = `slide theme-${project.theme}`;

      const previewRoot = document.getElementById("previewRoot");
      previewRoot.className = `preview-area theme-${project.theme}`;
    }

    function syncThemeButtonsOnLoad() {
      const btn = document.querySelector(`.theme-btn[data-theme="${project.theme}"]`);
      syncThemeUI(btn);
    }

    // =========================
    // ADD BLOCKS
    // =========================
    function addHero() {
      project.blocks.push(createBlock("hero", {
        title: "Novo t√≠tulo",
        subtitle: "Subt√≠tulo"
      }));
      saveProject();
      renderSlide();
    }

    function addCards() {
      project.blocks.push(createBlock("cards", {
        left: { title: "Card 1", text: "Descri√ß√£o" },
        right: { title: "Card 2", text: "Descri√ß√£o" }
      }));
      saveProject();
      renderSlide();
    }

    function addList() {
      project.blocks.push(createBlock("list", {
        title: "T√≠tulo da lista",
        items: ["Item 1", "Item 2", "Item 3"]
      }));
      saveProject();
      renderSlide();
    }

    function addQuote() {
      project.blocks.push(createBlock("quote", {
        text: "Uma cita√ß√£o",
        author: "Autor"
      }));
      saveProject();
      renderSlide();
    }

    // =========================
    // BLOCK OPS (best practices: remove / move / duplicate)
    // =========================
    function removeSelectedBlock() {
      const id = project.selectedBlockId;
      if (!id) return;

      project.blocks = project.blocks.filter(b => b.id !== id);
      project.selectedBlockId = null;

      saveProject();
      renderSlide();
      renderPropertiesPanel();
    }

    function duplicateSelectedBlock() {
      const b = getSelectedBlock();
      if (!b) return;

      const copy = createBlock(b.type, JSON.parse(JSON.stringify(b.data)));
      project.blocks.push(copy);
      project.selectedBlockId = copy.id;

      saveProject();
      renderSlide();
      renderPropertiesPanel();
    }

    function moveSelectedBlock(dir) {
      const id = project.selectedBlockId;
      if (!id) return;

      const idx = project.blocks.findIndex(b => b.id === id);
      if (idx < 0) return;

      const newIdx = idx + dir;
      if (newIdx < 0 || newIdx >= project.blocks.length) return;

      const temp = project.blocks[idx];
      project.blocks[idx] = project.blocks[newIdx];
      project.blocks[newIdx] = temp;

      saveProject();
      renderSlide();
      renderPropertiesPanel();
    }

    // =========================
    // RENDER
    // =========================
    function renderSlide() {
      const slide = document.getElementById("slide");
      slide.innerHTML = "";

      if (!project.blocks.length) {
        const empty = document.createElement("div");
        empty.className = "empty";
        empty.innerHTML = `
          <h3>Sem blocos ainda</h3>
          <p>Use a sidebar para adicionar Hero, Cards, Lista ou Quote. Depois clique no bloco para editar.</p>
        `;
        slide.appendChild(empty);
        return;
      }

      project.blocks.forEach(block => {
        const el = renderBlock(block);
        slide.appendChild(el);
      });
    }

    function renderBlock(block) {
      const wrapper = document.createElement("div");
      wrapper.className = "block";
      if (block.id === project.selectedBlockId) wrapper.classList.add("selected");

      wrapper.addEventListener("click", (e) => {
        e.stopPropagation();
        setSelectedBlock(block.id);
      });

      let content;
      switch (block.type) {
        case "hero":
          content = renderHero(block.data);
          break;
        case "cards":
          content = renderCards(block.data);
          break;
        case "list":
          content = renderList(block.data);
          break;
        case "quote":
          content = renderQuote(block.data);
          break;
        default:
          content = document.createElement("div");
          content.textContent = "Bloco desconhecido";
      }

      wrapper.appendChild(content);
      // espa√ßamento entre blocos
      wrapper.style.marginBottom = "18px";
      return wrapper;
    }

    function renderHero(data) {
      const div = document.createElement("div");
      div.className = "hero";
      div.innerHTML = `
        <h1>${escapeHtml(data.title || "")}</h1>
        <p>${escapeHtml(data.subtitle || "")}</p>
      `;
      return div;
    }

    function renderCards(data) {
      const div = document.createElement("div");
      div.className = "cards";
      div.innerHTML = `
        <div class="card">
          <h2>${escapeHtml(data.left?.title || "")}</h2>
          <p>${escapeHtml(data.left?.text || "")}</p>
        </div>
        <div class="card gray">
          <h2>${escapeHtml(data.right?.title || "")}</h2>
          <p>${escapeHtml(data.right?.text || "")}</p>
        </div>
      `;
      return div;
    }

    function renderList(data) {
      const div = document.createElement("div");
      div.className = "list-section";
      const items = Array.isArray(data.items) ? data.items : [];
      div.innerHTML = `
        <h2>${escapeHtml(data.title || "")}</h2>
        <ul>
          ${items.map(i => `<li>${escapeHtml(i || "")}</li>`).join("")}
        </ul>
      `;
      return div;
    }

    function renderQuote(data) {
      const div = document.createElement("div");
      div.className = "quote";
      div.innerHTML = `
        <blockquote>‚Äú${escapeHtml(data.text || "")}‚Äù</blockquote>
        <cite>‚Äî ${escapeHtml(data.author || "")}</cite>
      `;
      return div;
    }

    // Clique fora do bloco: deseleciona
    document.addEventListener("click", (e) => {
      // se clicar no preview, mas fora dos blocos
      const inPreview = e.target.closest(".slide");
      const inBlock = e.target.closest(".block");
      if (inPreview && !inBlock) {
        project.selectedBlockId = null;
        saveProject();
        renderSlide();
        renderPropertiesPanel();
      }
    });

    // =========================
    // PROPERTIES PANEL
    // =========================
    function renderPropertiesPanel() {
      const container = document.getElementById("propertiesSection");
      const panelHost = container.querySelector(".panel");
      const b = getSelectedBlock();

      if (!b) {
        panelHost.innerHTML = `<div class="muted">Selecione um bloco no preview para editar aqui.</div>`;
        return;
      }

      panelHost.innerHTML = `
        <div class="panel-top">
          <div class="panel-badge">${labelForType(b.type)}</div>
          <div class="panel-actions">
            <button class="icon-btn" title="Subir" onclick="moveSelectedBlock(-1)">‚Üë</button>
            <button class="icon-btn" title="Descer" onclick="moveSelectedBlock(1)">‚Üì</button>
            <button class="icon-btn" title="Duplicar" onclick="duplicateSelectedBlock()">‚ßâ</button>
            <button class="icon-btn" title="Remover" onclick="removeSelectedBlock()">‚úï</button>
          </div>
        </div>
        ${renderFieldsForBlock(b)}
      `;
    }

    function renderFieldsForBlock(block) {
      const t = block.type;

      if (t === "hero") {
        return `
          <div class="field">
            <label>T√≠tulo</label>
            <input class="input" value="${escapeAttr(block.data.title || "")}"
              oninput="updateSelectedData('title', this.value)" />
          </div>
          <div class="field">
            <label>Subt√≠tulo</label>
            <input class="input" value="${escapeAttr(block.data.subtitle || "")}"
              oninput="updateSelectedData('subtitle', this.value)" />
          </div>
        `;
      }

      if (t === "cards") {
        return `
          <div class="field">
            <label>Card esquerdo ‚Äî T√≠tulo</label>
            <input class="input" value="${escapeAttr(block.data.left?.title || "")}"
              oninput="updateSelectedNested('left','title', this.value)" />
          </div>
          <div class="field">
            <label>Card esquerdo ‚Äî Texto</label>
            <textarea class="textarea"
              oninput="updateSelectedNested('left','text', this.value)">${escapeHtml(block.data.left?.text || "")}</textarea>
          </div>
          <div class="field">
            <label>Card direito ‚Äî T√≠tulo</label>
            <input class="input" value="${escapeAttr(block.data.right?.title || "")}"
              oninput="updateSelectedNested('right','title', this.value)" />
          </div>
          <div class="field">
            <label>Card direito ‚Äî Texto</label>
            <textarea class="textarea"
              oninput="updateSelectedNested('right','text', this.value)">${escapeHtml(block.data.right?.text || "")}</textarea>
          </div>
        `;
      }

      if (t === "list") {
        const items = Array.isArray(block.data.items) ? block.data.items : [];
        return `
          <div class="field">
            <label>T√≠tulo</label>
            <input class="input" value="${escapeAttr(block.data.title || "")}"
              oninput="updateSelectedData('title', this.value)" />
          </div>
          <div class="field">
            <label>Itens (um por linha)</label>
            <textarea class="textarea"
              oninput="updateListItemsFromTextarea(this.value)">${escapeHtml(items.join("\n"))}</textarea>
          </div>
          <div class="muted" style="margin-top:10px;">
            Dica: cada linha vira um item da lista.
          </div>
        `;
      }

      if (t === "quote") {
        return `
          <div class="field">
            <label>Cita√ß√£o</label>
            <textarea class="textarea"
              oninput="updateSelectedData('text', this.value)">${escapeHtml(block.data.text || "")}</textarea>
          </div>
          <div class="field">
            <label>Autor</label>
            <input class="input" value="${escapeAttr(block.data.author || "")}"
              oninput="updateSelectedData('author', this.value)" />
          </div>
        `;
      }

      return `<div class="muted">Sem propriedades para este bloco.</div>`;
    }

    function updateSelectedData(field, value) {
      const b = getSelectedBlock();
      if (!b) return;
      b.data[field] = value;
      saveProject();
      renderSlide();
    }

    function updateSelectedNested(side, field, value) {
      const b = getSelectedBlock();
      if (!b) return;
      if (!b.data[side]) b.data[side] = {};
      b.data[side][field] = value;
      saveProject();
      renderSlide();
    }

    function updateListItemsFromTextarea(text) {
      const b = getSelectedBlock();
      if (!b) return;
      const lines = text.split("\n").map(s => s.trim()).filter(Boolean);
      b.data.items = lines;
      saveProject();
      renderSlide();
    }

    function labelForType(type) {
      switch (type) {
        case "hero": return "Hero";
        case "cards": return "Cards";
        case "list": return "Lista";
        case "quote": return "Quote";
        default: return "Bloco";
      }
    }

    // =========================
    // CLEAR
    // =========================
    function clearAll() {
      if (!confirm("Limpar todo o conte√∫do?")) return;
      project.blocks = [];
      project.selectedBlockId = null;
      saveProject();
      renderSlide();
      renderPropertiesPanel();
    }

    // =========================
    // EXPORT PDF (mant√©m tua l√≥gica; agora com estado s√≥lido)
    // =========================
    async function exportPDF() {
      const loading = document.getElementById("loading");
      loading.classList.add("active");

      try {
        const slide = document.getElementById("slide");
        // garante que nada est√° selecionado ‚Äúpintando‚Äù no export
        const prevSelected = project.selectedBlockId;
        project.selectedBlockId = null;
        renderSlide();

        const canvas = await html2canvas(slide, {
          scale: 2,
          backgroundColor: "#ffffff",
          width: 1000,
          height: 700
        });

        // restaura sele√ß√£o
        project.selectedBlockId = prevSelected;
        renderSlide();

        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
          orientation: "landscape",
          unit: "px",
          format: [1000, 700]
        });

        const imgData = canvas.toDataURL("image/png");
        pdf.addImage(imgData, "PNG", 0, 0, 1000, 700);
        pdf.save("linkren-presentation.pdf");
        alert("‚úÖ PDF exportado!");
      } catch (e) {
        console.error(e);
        alert("‚ùå Erro ao exportar PDF");
      } finally {
        loading.classList.remove("active");
      }
    }

    // =========================
    // EXPORT PPT (baseado em blocks[] ‚Äî pronto)
    // =========================
    function resolveThemeForPPT(themeName) {
      if (themeName === "dark") {
        return { background: "000000", text: "FFFFFF", accent: "4ADE80", muted: "AAAAAA" };
      }
      return { background: "FFFFFF", text: "111827", accent: "4ADE80", muted: "6B7280" };
    }

    function exportPPTFromData() {
      if (!project.blocks.length) {
        alert("‚ö†Ô∏è N√£o h√° blocos para exportar.");
        return;
      }
      exportPPT(project);
    }

    function exportPPT(projectData) {
      const pptx = new PptxGenJS();
      const theme = resolveThemeForPPT(projectData.theme);

      pptx.defineLayout({ name: "LINKREN", width: 13.33, height: 7.5 });
      pptx.layout = "LINKREN";

      projectData.blocks.forEach(block => {
        const slide = pptx.addSlide();
        slide.background = { fill: theme.background };

        switch (block.type) {
          case "hero":  renderHeroSlide(slide, block.data, theme); break;
          case "cards": renderCardsSlide(slide, block.data, theme); break;
          case "list":  renderListSlide(slide, block.data, theme); break;
          case "quote": renderQuoteSlide(slide, block.data, theme); break;
        }
      });

      pptx.writeFile({ fileName: "linkren-presentation.pptx" });
    }

    function renderHeroSlide(slide, data, theme) {
      slide.addText(data.title || "", {
        x: 1.3, y: 2.5, w: 10.7, h: 1.4,
        fontSize: 44, bold: true, color: theme.text, align: "center"
      });
      slide.addText(data.subtitle || "", {
        x: 2.0, y: 4.1, w: 9.3, h: 1.0,
        fontSize: 20, color: theme.muted, align: "center"
      });
    }

    function renderCardsSlide(slide, data, theme) {
      // left
      slide.addShape("rect", { x: 0.8, y: 1.6, w: 5.9, h: 4.2, fill: theme.accent, round: 0.2 });
      slide.addText(data.left?.title || "", { x: 1.1, y: 2.1, w: 5.3, h: 0.7, fontSize: 26, bold: true, color: "FFFFFF", align: "center" });
      slide.addText(data.left?.text || "",  { x: 1.1, y: 3.0, w: 5.3, h: 2.2, fontSize: 16, color: "FFFFFF", align: "center" });

      // right
      slide.addShape("rect", { x: 6.7, y: 1.6, w: 5.9, h: 4.2, fill: "4B5563", round: 0.2 });
      slide.addText(data.right?.title || "", { x: 7.0, y: 2.1, w: 5.3, h: 0.7, fontSize: 26, bold: true, color: "FFFFFF", align: "center" });
      slide.addText(data.right?.text || "",  { x: 7.0, y: 3.0, w: 5.3, h: 2.2, fontSize: 16, color: "FFFFFF", align: "center" });
    }

    function renderListSlide(slide, data, theme) {
      slide.addText(data.title || "", {
        x: 1.0, y: 0.8, w: 11.3, h: 0.9,
        fontSize: 34, bold: true, color: theme.text
      });

      const items = Array.isArray(data.items) ? data.items : [];
      const bulletRuns = items.map(t => ({ text: t, options: { bullet: true } }));

      slide.addText(bulletRuns, {
        x: 1.2, y: 2.0, w: 11.0, h: 5.0,
        fontSize: 18, color: theme.text, lineSpacingMultiple: 1.25
      });
    }

    function renderQuoteSlide(slide, data, theme) {
      slide.background = { fill: "1E3A2F" };
      slide.addText(`‚Äú${data.text || ""}‚Äù`, {
        x: 1.2, y: 2.0, w: 11.0, h: 2.2,
        fontSize: 30, bold: true, color: "FFFFFF", align: "center"
      });
      slide.addText(`‚Äî ${data.author || ""}`, {
        x: 4.0, y: 4.7, w: 5.3, h: 0.6,
        fontSize: 16, color: "FFFFFF", align: "center"
      });
    }

    // =========================
    // SAFETY: escape helpers
    // =========================
    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }
    function escapeAttr(str) {
      return escapeHtml(str).replaceAll("\n", " ");
    }

    // =========================
    // INIT
    // =========================
    window.addEventListener("load", () => {
      loadProject();
      syncThemeButtonsOnLoad();
      renderSlide();
      renderPropertiesPanel();
    });

    // CTRL+S
    document.addEventListener("keydown", (e) => {
      if (e.ctrlKey && (e.key === "s" || e.key === "S")) {
        e.preventDefault();
        saveProjectManual();
      }
    });
  </script>
</body>
</html>
