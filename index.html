<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Linkren Presentation Studio Pro</title>

  <!-- PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- PPT export -->
  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(180deg, #F3F4F6 0%, #E5E7EB 100%);
      overflow-x: hidden;
    }

    /* HEADER */
    .header {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      padding: 16px 32px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08), 0 4px 12px rgba(0,0,0,0.04);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .logo-area {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #4ADE80, #22C55E);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 4px 12px rgba(74, 222, 128, 0.25);
    }
    
    .logo {
      font-size: 19px;
      font-weight: 900;
      color: #111827;
      letter-spacing: -0.3px;
    }
    
    .header-actions { 
      display: flex; 
      align-items: center; 
      flex-wrap: wrap; 
      gap: 8px; 
    }

    .btn {
      padding: 10px 16px;
      background: linear-gradient(135deg, #4ADE80, #22C55E);
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 2px 8px rgba(74, 222, 128, 0.25);
    }
    .btn:hover { 
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(74, 222, 128, 0.35);
    }
    .btn:active { transform: translateY(0); }

    .btn-secondary {
      background: rgba(17, 24, 39, 0.06);
      color: #111827;
      box-shadow: none;
    }
    .btn-secondary:hover { 
      background: rgba(17, 24, 39, 0.1);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    /* LAYOUT */
    .main-container {
      display: grid;
      grid-template-columns: 340px 1fr;
      height: calc(100vh - 68px);
      gap: 0;
    }

    /* SIDEBAR */
    .sidebar {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      padding: 20px;
      overflow-y: auto;
      border-right: 1px solid rgba(0, 0, 0, 0.06);
    }
    
    .sidebar::-webkit-scrollbar { width: 8px; }
    .sidebar::-webkit-scrollbar-track { background: transparent; }
    .sidebar::-webkit-scrollbar-thumb { 
      background: rgba(0, 0, 0, 0.1);
      border-radius: 10px;
    }
    
    .section { margin-bottom: 24px; }
    .section-title {
      font-size: 11px;
      font-weight: 800;
      color: #6B7280;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .theme-btn {
      width: 100%;
      padding: 12px 14px;
      margin-bottom: 8px;
      background: rgba(17, 24, 39, 0.04);
      border: 1px solid transparent;
      border-radius: 10px;
      text-align: left;
      font-weight: 700;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .theme-btn:hover { 
      background: rgba(74, 222, 128, 0.08);
      transform: translateX(2px);
    }
    .theme-btn.active {
      background: linear-gradient(135deg, #4ADE80, #22C55E);
      color: white;
      border-color: #22C55E;
      box-shadow: 0 2px 8px rgba(74, 222, 128, 0.25);
    }

    .component-item {
      background: white;
      border: 1px solid rgba(0, 0, 0, 0.06);
      padding: 14px;
      margin-bottom: 8px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .component-item:hover {
      border-color: #4ADE80;
      background: rgba(74, 222, 128, 0.04);
      transform: translateX(2px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }
    
    .component-icon { 
      font-size: 24px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(74, 222, 128, 0.1);
      border-radius: 8px;
    }
    .component-name { 
      font-weight: 700; 
      font-size: 13px; 
      color: #111827;
      flex: 1;
    }

    /* PROPERTIES PANEL */
    .panel {
      border: 1px solid rgba(0, 0, 0, 0.06);
      background: white;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
    }
    
    .panel-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    }
    
    .panel-badge {
      font-size: 12px;
      font-weight: 800;
      color: #111827;
      background: rgba(74, 222, 128, 0.1);
      padding: 6px 10px;
      border-radius: 6px;
    }
    
    .panel-actions { display: flex; gap: 6px; }
    
    .icon-btn {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: 1px solid rgba(0, 0, 0, 0.06);
      background: rgba(17, 24, 39, 0.04);
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      color: #111827;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .icon-btn:hover { 
      background: rgba(74, 222, 128, 0.1);
      border-color: #4ADE80;
      transform: translateY(-1px);
    }
    .icon-btn:active { transform: translateY(0); }

    .field { margin-top: 12px; }
    .field label {
      display: block;
      font-size: 11px;
      font-weight: 800;
      color: #6B7280;
      margin-bottom: 6px;
      letter-spacing: 0.4px;
      text-transform: uppercase;
    }
    
    .input, .textarea, .select {
      width: 100%;
      border: 1px solid rgba(0, 0, 0, 0.1);
      background: white;
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 13px;
      font-family: inherit;
      outline: none;
      transition: all 0.2s;
    }
    .input:focus, .textarea:focus, .select:focus {
      border-color: #4ADE80;
      box-shadow: 0 0 0 4px rgba(74, 222, 128, 0.1);
    }
    .textarea { min-height: 80px; resize: vertical; }

    .color-input {
      width: 100%;
      height: 44px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      cursor: pointer;
    }

    .muted {
      font-size: 12px;
      color: #6B7280;
      line-height: 1.6;
    }

    /* IMAGE UPLOAD */
    .image-upload-area {
      width: 100%;
      min-height: 180px;
      border: 2px dashed rgba(0, 0, 0, 0.15);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      background: rgba(243, 244, 246, 0.5);
      margin-bottom: 8px;
    }
    .image-upload-area:hover {
      border-color: #4ADE80;
      background: rgba(74, 222, 128, 0.05);
    }
    .image-upload-area.has-image {
      border-style: solid;
      border-color: rgba(0, 0, 0, 0.1);
      padding: 0;
      min-height: 200px;
    }
    .upload-icon {
      font-size: 48px;
      margin-bottom: 12px;
      opacity: 0.5;
    }
    .upload-placeholder {
      font-size: 13px;
      font-weight: 600;
      color: #6B7280;
    }
    .image-preview {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
      min-height: 200px;
    }
    .image-actions {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    .btn-small {
      padding: 8px 14px;
      background: rgba(17, 24, 39, 0.06);
      color: #111827;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-small:hover {
      background: rgba(74, 222, 128, 0.1);
      border-color: #4ADE80;
    }
    .btn-small.danger:hover {
      background: rgba(239, 68, 68, 0.1);
      border-color: #EF4444;
      color: #EF4444;
    }

    /* TIMELINE MANAGER */
    .timeline-manager {
      margin-top: 12px;
    }
    .timeline-item-editor {
      background: rgba(243, 244, 246, 0.8);
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 10px;
      position: relative;
    }
    .timeline-item-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    }
    .timeline-item-number {
      font-size: 11px;
      font-weight: 800;
      color: #4ADE80;
      background: rgba(74, 222, 128, 0.15);
      padding: 4px 10px;
      border-radius: 6px;
    }
    .timeline-item-actions {
      display: flex;
      gap: 4px;
    }
    .mini-btn {
      width: 28px;
      height: 28px;
      border: 1px solid rgba(0, 0, 0, 0.08);
      background: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 700;
      color: #6B7280;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .mini-btn:hover {
      background: #4ADE80;
      color: white;
      border-color: #4ADE80;
    }
    .mini-btn.danger:hover {
      background: #EF4444;
      border-color: #EF4444;
    }
    .add-timeline-item-btn {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #4ADE80, #22C55E);
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin-top: 8px;
    }
    .add-timeline-item-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(74, 222, 128, 0.35);
    }

    /* STATS MANAGER */
    .stats-manager {
      margin-top: 12px;
    }
    .stat-item-editor {
      background: rgba(243, 244, 246, 0.8);
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 10px;
    }
    .stat-item-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    }
    .stat-item-number {
      font-size: 11px;
      font-weight: 800;
      color: #4ADE80;
      background: rgba(74, 222, 128, 0.15);
      padding: 4px 10px;
      border-radius: 6px;
    }
    .stat-fields {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    /* TABLE MANAGER */
    .table-manager {
      margin-top: 12px;
    }
    .table-header-editor {
      background: rgba(243, 244, 246, 0.8);
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 10px;
    }
    .table-section-title {
      font-size: 11px;
      font-weight: 800;
      color: #6B7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .table-headers-grid {
      display: grid;
      gap: 8px;
    }
    .table-header-item {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    .table-header-item .input {
      flex: 1;
    }
    .table-row-editor {
      background: rgba(243, 244, 246, 0.8);
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 10px;
    }
    .table-row-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    }
    .table-row-number {
      font-size: 11px;
      font-weight: 800;
      color: #4ADE80;
      background: rgba(74, 222, 128, 0.15);
      padding: 4px 10px;
      border-radius: 6px;
    }
    .table-cells-grid {
      display: grid;
      gap: 8px;
    }

    /* PREVIEW AREA */
    .preview-area {
      background: linear-gradient(135deg, #0F172A, #1E293B);
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 80px 40px 40px 40px;
      position: relative;
      overflow: auto;
      min-height: 100%;
    }
    .preview-area::-webkit-scrollbar { width: 12px; }
    .preview-area::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.2); }
    .preview-area::-webkit-scrollbar-thumb { 
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
    }
    .preview-area::-webkit-scrollbar-thumb:hover { 
      background: rgba(255, 255, 255, 0.3);
    }
    
    .preview-controls {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      padding: 8px 12px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .zoom-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.2s;
    }
    .zoom-btn:hover { background: rgba(0, 0, 0, 0.06); }
    
    .zoom-display {
      font-size: 12px;
      font-weight: 700;
      color: #6B7280;
      min-width: 50px;
      text-align: center;
    }

    .slide {
      width: 1000px;
      min-height: 700px;
      max-height: none;
      background: white;
      border-radius: 16px;
      padding: 56px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      position: relative;
      transform-origin: center top;
      transition: transform 0.3s ease;
      overflow: visible;
    }

    /* BLOCK WRAPPER */
    .block {
      position: relative;
      border-radius: 12px;
      transition: all 0.2s ease;
      cursor: grab;
      margin-bottom: 20px;
    }
    .block:hover { 
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    .block.selected {
      outline: 2px solid #4ADE80;
      box-shadow: 0 0 0 6px rgba(74, 222, 128, 0.12);
    }
    .block.dragging {
      opacity: 0.5;
      cursor: grabbing;
    }
    .block.drag-over {
      border-top: 3px solid #4ADE80;
    }

    /* Drag handle */
    .drag-handle {
      position: absolute;
      left: -35px;
      top: 50%;
      transform: translateY(-50%);
      width: 24px;
      height: 40px;
      background: rgba(74, 222, 128, 0.1);
      border-radius: 6px;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: grab;
      color: #4ADE80;
      font-size: 16px;
    }
    .block:hover .drag-handle {
      display: flex;
    }
    .drag-handle:active {
      cursor: grabbing;
    }

    /* COMPONENTS */
    .hero { 
      text-align: center; 
      padding: 40px 0; 
    }
    .hero h1 {
      font-size: 56px;
      font-weight: 900;
      margin-bottom: 16px;
      letter-spacing: -1.8px;
      line-height: 1.1;
      color: #111827;
    }
    .hero p { 
      font-size: 20px; 
      color: #6B7280; 
      font-weight: 600;
      line-height: 1.4;
    }

    .cards {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }
    .card {
      background: linear-gradient(135deg, #4ADE80, #22C55E);
      color: white;
      padding: 40px 32px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(74, 222, 128, 0.25);
    }
    .card h2 { 
      font-size: 32px; 
      font-weight: 900; 
      margin-bottom: 12px;
      letter-spacing: -0.5px;
    }
    .card p { 
      font-size: 16px; 
      opacity: 0.95; 
      font-weight: 600;
      line-height: 1.5;
    }
    .card.custom-color { background: var(--custom-bg); }

    .list-section { }
    .list-section h2 {
      font-size: 36px;
      font-weight: 900;
      margin-bottom: 20px;
      color: #111827;
      letter-spacing: -1px;
    }
    .list-section ul { 
      padding-left: 24px;
      list-style: none;
    }
    .list-section li {
      margin-bottom: 12px;
      font-size: 16px;
      line-height: 1.6;
      color: #374151;
      font-weight: 600;
      position: relative;
      padding-left: 0;
    }
    .list-section li::before {
      content: "‚Ä¢";
      color: #4ADE80;
      font-weight: 900;
      font-size: 20px;
      position: absolute;
      left: -24px;
    }

    .quote {
      background: linear-gradient(135deg, #1E3A2F, #0F2922);
      color: white;
      padding: 48px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    .quote blockquote {
      font-size: 28px;
      font-weight: 800;
      line-height: 1.4;
      margin-bottom: 20px;
      letter-spacing: -0.3px;
    }
    .quote cite { 
      font-size: 15px; 
      opacity: 0.9; 
      font-weight: 700;
    }

    /* Timeline */
    .timeline {
      padding: 20px 0;
    }
    .timeline h2 {
      font-size: 36px;
      font-weight: 900;
      margin-bottom: 32px;
      color: #111827;
      letter-spacing: -1px;
    }
    .timeline-item {
      display: flex;
      gap: 24px;
      margin-bottom: 28px;
      position: relative;
    }
    .timeline-dot {
      width: 16px;
      height: 16px;
      background: #4ADE80;
      border-radius: 50%;
      margin-top: 4px;
      flex-shrink: 0;
      box-shadow: 0 0 0 4px rgba(74, 222, 128, 0.2);
    }
    .timeline-content h3 {
      font-size: 20px;
      font-weight: 800;
      color: #111827;
      margin-bottom: 6px;
    }
    .timeline-content p {
      font-size: 15px;
      color: #6B7280;
      line-height: 1.6;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .stat-card {
      background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(34, 197, 94, 0.05));
      border: 1px solid rgba(74, 222, 128, 0.2);
      padding: 28px;
      border-radius: 14px;
      text-align: center;
    }
    .stat-value {
      font-size: 44px;
      font-weight: 900;
      color: #4ADE80;
      margin-bottom: 8px;
      letter-spacing: -1px;
    }
    .stat-label {
      font-size: 14px;
      font-weight: 700;
      color: #6B7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Image + Text */
    .image-text {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      align-items: center;
    }
    .image-text-img {
      width: 100%;
      height: 280px;
      background: linear-gradient(135deg, #E5E7EB, #D1D5DB);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 60px;
      color: #9CA3AF;
      overflow: hidden;
    }
    .image-text-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .image-text-content h2 {
      font-size: 32px;
      font-weight: 900;
      margin-bottom: 16px;
      color: #111827;
      letter-spacing: -0.8px;
    }
    .image-text-content p {
      font-size: 16px;
      color: #6B7280;
      line-height: 1.6;
      font-weight: 500;
    }

    /* CTA */
    .cta {
      background: linear-gradient(135deg, #4ADE80, #22C55E);
      color: white;
      padding: 52px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 8px 24px rgba(74, 222, 128, 0.3);
    }
    .cta h2 {
      font-size: 40px;
      font-weight: 900;
      margin-bottom: 16px;
      letter-spacing: -1px;
    }
    .cta p {
      font-size: 18px;
      margin-bottom: 28px;
      opacity: 0.95;
      font-weight: 600;
    }
    .cta-button {
      display: inline-block;
      background: white;
      color: #22C55E;
      padding: 16px 40px;
      border-radius: 12px;
      font-weight: 900;
      font-size: 16px;
      text-decoration: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    /* CONCLUS√ÉO */
    .conclusion {
      background: linear-gradient(135deg, #3B82F6, #2563EB);
      color: white;
      padding: 48px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
    }
    .conclusion h2 {
      font-size: 36px;
      font-weight: 900;
      margin-bottom: 20px;
      letter-spacing: -1px;
    }
    .conclusion p {
      font-size: 18px;
      line-height: 1.7;
      opacity: 0.95;
      font-weight: 500;
    }

    /* JUSTIFICATIVA */
    .justification {
      background: white;
      border-left: 6px solid #F59E0B;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    .justification h2 {
      font-size: 32px;
      font-weight: 900;
      margin-bottom: 20px;
      color: #F59E0B;
      letter-spacing: -0.8px;
    }
    .justification p {
      font-size: 17px;
      color: #374151;
      line-height: 1.8;
      font-weight: 500;
    }

    /* HIGHLIGHT BOX */
    .highlight {
      background: linear-gradient(135deg, #EC4899, #DB2777);
      color: white;
      padding: 44px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(236, 72, 153, 0.3);
    }
    .highlight h2 {
      font-size: 34px;
      font-weight: 900;
      margin-bottom: 16px;
      letter-spacing: -0.8px;
    }
    .highlight p {
      font-size: 17px;
      line-height: 1.7;
      opacity: 0.95;
      font-weight: 600;
    }

    /* INFO BOX */
    .info-box {
      background: linear-gradient(135deg, #8B5CF6, #7C3AED);
      color: white;
      padding: 44px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(139, 92, 246, 0.3);
    }
    .info-box h2 {
      font-size: 34px;
      font-weight: 900;
      margin-bottom: 16px;
      letter-spacing: -0.8px;
    }
    .info-box p {
      font-size: 17px;
      line-height: 1.7;
      opacity: 0.95;
      font-weight: 600;
    }

    /* Table */
    .table-wrapper {
      overflow-x: auto;
    }
    .table-wrapper h2 {
      font-size: 36px;
      font-weight: 900;
      margin-bottom: 24px;
      color: #111827;
      letter-spacing: -1px;
    }
    .simple-table {
      width: 100%;
      border-collapse: collapse;
    }
    .simple-table th {
      background: rgba(74, 222, 128, 0.1);
      color: #111827;
      padding: 14px 16px;
      text-align: left;
      font-weight: 800;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 2px solid #4ADE80;
    }
    .simple-table td {
      padding: 14px 16px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
      color: #374151;
      font-weight: 600;
      font-size: 14px;
    }
    .simple-table tr:hover {
      background: rgba(74, 222, 128, 0.04);
    }

    /* THEMES */
    .theme-dark .slide { background: #0A0A0A; color: white; }
    .theme-dark .hero h1, .theme-dark .list-section h2, 
    .theme-dark .timeline h2, .theme-dark .table-wrapper h2,
    .theme-dark .image-text-content h2, .theme-dark .justification h2 { color: white; }
    .theme-dark .hero p, .theme-dark .list-section li,
    .theme-dark .timeline-content h3, .theme-dark .image-text-content p,
    .theme-dark .justification p { color: rgba(255,255,255,0.75); }
    .theme-dark .simple-table th { background: rgba(74, 222, 128, 0.15); color: white; }
    .theme-dark .simple-table td { color: rgba(255,255,255,0.8); border-bottom-color: rgba(255,255,255,0.1); }
    .theme-dark .justification { 
      background: rgba(245, 158, 11, 0.1); 
      border-left-color: #F59E0B;
    }

    /* EMPTY STATE */
    .empty {
      border: 1px dashed rgba(17,24,39,0.2);
      border-radius: 16px;
      padding: 60px 32px;
      text-align: center;
      color: #374151;
      background: rgba(243,244,246,0.5);
    }
    .empty-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    .empty h3 { 
      font-size: 20px; 
      font-weight: 900; 
      margin-bottom: 8px; 
      color: #111827; 
    }
    .empty p { 
      font-size: 14px; 
      color: #6B7280; 
      font-weight: 600;
      line-height: 1.6;
    }

    /* LOADING */
    .loading {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(8px);
    }
    .loading.active { display: flex; }
    .loading-content {
      text-align: center;
      color: white;
    }
    .spinner {
      width: 58px;
      height: 58px;
      border: 5px solid rgba(74,222,128,0.25);
      border-top-color: #4ADE80;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 16px;
    }
    .loading-text {
      font-size: 14px;
      font-weight: 700;
      color: rgba(255,255,255,0.9);
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* TOAST */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: rgba(17, 24, 39, 0.95);
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(20px);
      z-index: 1000;
      animation: slideIn 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    @keyframes slideIn {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* RESPONSIVE */
    @media (max-width: 1200px) {
      .main-container { grid-template-columns: 300px 1fr; }
    }
    @media (max-width: 900px) {
      .main-container { 
        grid-template-columns: 1fr; 
        height: auto;
      }
      .sidebar { 
        max-height: 300px;
        border-right: none;
        border-bottom: 1px solid rgba(0, 0, 0, 0.06);
      }
      .preview-area { min-height: 600px; }
    }
  </style>
</head>

<body>
  <div class="loading" id="loading">
    <div class="loading-content">
      <div class="spinner"></div>
      <div class="loading-text" id="loadingText">Processando...</div>
    </div>
  </div>

  <header class="header">
    <div class="logo-area">
      <div class="logo-icon">‚ú®</div>
      <div class="logo">LINKREN STUDIO</div>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" onclick="undoAction()" title="Desfazer (Ctrl+Z)">
        <span>‚Ü∂</span>
      </button>
      <button class="btn btn-secondary" onclick="redoAction()" title="Refazer (Ctrl+Y)">
        <span>‚Ü∑</span>
      </button>
      <button class="btn btn-secondary" onclick="clearAll()">
        <span>üóëÔ∏è</span> Limpar
      </button>
      <button class="btn btn-secondary" onclick="saveProjectManual()">
        <span>üíæ</span> Salvar
      </button>
      <button class="btn btn-secondary" onclick="exportPPTFromData()">
        <span>üìä</span> PPT
      </button>
      <button class="btn" onclick="exportPDF()">
        <span>üìÑ</span> PDF
      </button>
    </div>
  </header>

  <div class="main-container">
    <aside class="sidebar">
      <div class="section" id="propertiesSection">
        <h3 class="section-title">
          <span>‚öôÔ∏è</span> Propriedades
        </h3>
        <div class="panel">
          <div class="muted">
            Selecione um bloco no preview para editar.
          </div>
        </div>
      </div>

      <div class="section">
        <h3 class="section-title">
          <span>üé®</span> Temas
        </h3>
        <button class="theme-btn" data-theme="default" onclick="changeTheme('default', this)">
          <span>‚ú®</span> Avenue (Padr√£o)
        </button>
        <button class="theme-btn" data-theme="dark" onclick="changeTheme('dark', this)">
          <span>üåô</span> Dark Mode
        </button>
      </div>

      <div class="section">
        <h3 class="section-title">
          <span>üß©</span> Componentes
        </h3>

        <div class="component-item" onclick="addHero()">
          <div class="component-icon">üì∞</div>
          <div class="component-name">Hero Title</div>
        </div>

        <div class="component-item" onclick="addCards()">
          <div class="component-icon">üìä</div>
          <div class="component-name">Two Cards</div>
        </div>

        <div class="component-item" onclick="addList()">
          <div class="component-icon">üìù</div>
          <div class="component-name">Lista</div>
        </div>

        <div class="component-item" onclick="addQuote()">
          <div class="component-icon">üí¨</div>
          <div class="component-name">Quote Box</div>
        </div>

        <div class="component-item" onclick="addTimeline()">
          <div class="component-icon">‚è±Ô∏è</div>
          <div class="component-name">Timeline</div>
        </div>

        <div class="component-item" onclick="addStats()">
          <div class="component-icon">üìà</div>
          <div class="component-name">Stats Grid</div>
        </div>

        <div class="component-item" onclick="addImageText()">
          <div class="component-icon">üñºÔ∏è</div>
          <div class="component-name">Imagem + Texto</div>
        </div>

        <div class="component-item" onclick="addCTA()">
          <div class="component-icon">üéØ</div>
          <div class="component-name">Call to Action</div>
        </div>

        <div class="component-item" onclick="addTable()">
          <div class="component-icon">üìã</div>
          <div class="component-name">Tabela</div>
        </div>

        <div class="component-item" onclick="addConclusion()">
          <div class="component-icon">üéØ</div>
          <div class="component-name">Conclus√£o</div>
        </div>

        <div class="component-item" onclick="addJustification()">
          <div class="component-icon">üìå</div>
          <div class="component-name">Justificativa</div>
        </div>

        <div class="component-item" onclick="addHighlight()">
          <div class="component-icon">‚≠ê</div>
          <div class="component-name">Destaque Rosa</div>
        </div>

        <div class="component-item" onclick="addInfoBox()">
          <div class="component-icon">üíú</div>
          <div class="component-name">Info Roxo</div>
        </div>
      </div>

      <div class="section">
        <h3 class="section-title">
          <span>üí°</span> Dica
        </h3>
        <p class="muted">
          Use <strong>Ctrl+Z</strong> para desfazer e <strong>Del</strong> para remover blocos selecionados.
        </p>
      </div>
    </aside>

    <main class="preview-area" id="previewRoot">
      <div class="preview-controls">
        <button class="zoom-btn" onclick="zoomOut()" title="Diminuir zoom">‚àí</button>
        <div class="zoom-display" id="zoomDisplay">100%</div>
        <button class="zoom-btn" onclick="zoomIn()" title="Aumentar zoom">+</button>
        <button class="zoom-btn" onclick="resetZoom()" title="Resetar zoom">‚ü≤</button>
      </div>
      <div class="slide theme-default" id="slide"></div>
    </main>
  </div>

  <script>
    // =========================
    // STATE
    // =========================
    const STORAGE_KEY = "linkren_project_v2";
    const MAX_HISTORY = 50;

    let project = {
      version: "2.0",
      theme: "default",
      blocks: [],
      selectedBlockId: null,
      zoom: 1,
      updatedAt: null
    };

    let history = {
      past: [],
      future: []
    };

    // =========================
    // HISTORY (UNDO/REDO)
    // =========================
    function saveHistory() {
      const snapshot = JSON.parse(JSON.stringify(project));
      history.past.push(snapshot);
      if (history.past.length > MAX_HISTORY) history.past.shift();
      history.future = [];
    }

    function undoAction() {
      if (history.past.length === 0) {
        showToast("‚ö†Ô∏è Nada para desfazer");
        return;
      }
      const current = JSON.parse(JSON.stringify(project));
      history.future.push(current);
      project = history.past.pop();
      saveProject();
      renderSlide();
      renderPropertiesPanel();
      syncThemeButtonsOnLoad();
      showToast("‚Ü∂ Desfeito");
    }

    function redoAction() {
      if (history.future.length === 0) {
        showToast("‚ö†Ô∏è Nada para refazer");
        return;
      }
      const current = JSON.parse(JSON.stringify(project));
      history.past.push(current);
      project = history.future.pop();
      saveProject();
      renderSlide();
      renderPropertiesPanel();
      syncThemeButtonsOnLoad();
      showToast("‚Ü∑ Refeito");
    }

    // =========================
    // STORAGE
    // =========================
    function saveProject() {
      project.updatedAt = new Date().toISOString();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(project));
    }

    function saveProjectManual() {
      saveProject();
      showToast("‚úÖ Projeto salvo!");
    }

    function loadProject() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (!saved) return;
      try {
        const parsed = JSON.parse(saved);
        if (parsed && Array.isArray(parsed.blocks)) {
          project = { ...project, ...parsed };
          project.zoom = project.zoom || 1;
        }
      } catch (e) {
        console.error("Erro ao carregar projeto", e);
      }
    }

    // =========================
    // HELPERS
    // =========================
    function uuid() {
      if (crypto && crypto.randomUUID) return crypto.randomUUID();
      return "id-" + Math.random().toString(16).slice(2) + "-" + Date.now();
    }

    function createBlock(type, data) {
      return { id: uuid(), type, data };
    }

    function getSelectedBlock() {
      return project.blocks.find(b => b.id === project.selectedBlockId) || null;
    }

    function setSelectedBlock(id) {
      project.selectedBlockId = id;
      saveProject();
      renderSlide();
      renderPropertiesPanel();
    }

    // =========================
    // ZOOM
    // =========================
    function zoomIn() {
      if (project.zoom >= 2) return;
      project.zoom = Math.min(2, project.zoom + 0.1);
      applyZoom();
      saveProject();
    }

    function zoomOut() {
      if (project.zoom <= 0.25) return;
      project.zoom = Math.max(0.25, project.zoom - 0.1);
      applyZoom();
      saveProject();
    }

    function resetZoom() {
      project.zoom = 1;
      applyZoom();
      saveProject();
    }

    function applyZoom() {
      const slide = document.getElementById("slide");
      slide.style.transform = `scale(${project.zoom})`;
      document.getElementById("zoomDisplay").textContent = Math.round(project.zoom * 100) + "%";
    }

    // =========================
    // THEME
    // =========================
    function changeTheme(theme, btnEl) {
      saveHistory();
      project.theme = theme;
      saveProject();
      syncThemeUI(btnEl);
      renderSlide();
      showToast(`üé® Tema: ${theme}`);
    }

    function syncThemeUI(btnEl) {
      document.querySelectorAll(".theme-btn").forEach(b => b.classList.remove("active"));
      if (btnEl) btnEl.classList.add("active");

      const slide = document.getElementById("slide");
      slide.className = `slide theme-${project.theme}`;

      const previewRoot = document.getElementById("previewRoot");
      previewRoot.className = `preview-area theme-${project.theme}`;
    }

    function syncThemeButtonsOnLoad() {
      const btn = document.querySelector(`.theme-btn[data-theme="${project.theme}"]`);
      syncThemeUI(btn);
    }

    // =========================
    // ADD BLOCKS
    // =========================
    function addHero() {
      saveHistory();
      project.blocks.push(createBlock("hero", {
        title: "Novo t√≠tulo",
        subtitle: "Subt√≠tulo inspirador"
      }));
      saveProject();
      renderSlide();
      showToast("‚úÖ Hero adicionado");
    }

    function addCards() {
      saveHistory();
      project.blocks.push(createBlock("cards", {
        left: { title: "Card 1", text: "Descri√ß√£o do primeiro card", color: "#4ADE80" },
        right: { title: "Card 2", text: "Descri√ß√£o do segundo card", color: "#6B7280" }
      }));
      saveProject();
      renderSlide();
      showToast("‚úÖ Cards adicionados");
    }

    function addList() {
      saveHistory();
      project.blocks.push(createBlock("list", {
        title: "T√≠tulo da lista",
        items: ["Item 1", "Item 2", "Item 3"]
      }));
      saveProject();
      renderSlide();
      showToast("‚úÖ Lista adicionada");
    }

    function addQuote() {
      saveHistory();
      project.blocks.push(createBlock("quote", {
        text: "Uma cita√ß√£o inspiradora",
        author: "Autor Desconhecido"
      }));
      saveProject();
      renderSlide();
      showToast("‚úÖ Quote adicionado");
    }

    function addTimeline() {
      saveHistory();
      project.blocks.push(createBlock("timeline", {
        title: "Nossa Jornada",
        items: [
          { title: "Fase 1", text: "Descri√ß√£o da primeira fase" },
          { title: "Fase 2", text: "Descri√ß√£o da segunda fase" },
          { title: "Fase 3", text: "Descri√ß√£o da terceira fase" }
        ]
      }));
      saveProject();
      renderSlide();
      showToast("‚úÖ Timeline adicionado");
    }

    function addStats() {
      saveHistory();
      project.blocks.push(createBlock("stats", {
        stats: [
          { value: "10K+", label: "Clientes" },
          { value: "95%", label: "Satisfa√ß√£o" },
          { value: "24/7", label: "Suporte" },
          { value: "50+", label: "Pa√≠ses" }
        ]
      }));
      saveProject();
      renderSlide();
      showToast("‚úÖ Stats adicionados");
    }

    function addImageText() {
      saveHistory();
      project.blocks.push(createBlock("imagetext", {
        title: "T√≠tulo da Se√ß√£o",
        text: "Descri√ß√£o detalhada sobre o conte√∫do apresentado nesta se√ß√£o.",
        imagePosition: "left",
        image: null
      }));
      saveProject();
      renderSlide();
      showToast("‚úÖ Imagem + Texto adicionado");
    }

    function addCTA() {
      saveHistory();
      project.blocks.push(createBlock("cta", {
        title: "Pronto para come√ßar?",
        text: "Junte-se a milhares de clientes satisfeitos",
        buttonText: "Come√ßar Agora"
      }));
      saveProject();
      renderSlide();
      showToast("‚úÖ CTA adicionado");
    }

    function addTable() {
      saveHistory();
      project.blocks.push(createBlock("table", {
        title: "Tabela de Dados",
        headers: ["Coluna 1", "Coluna 2", "Coluna 3"],
        rows: [
          ["Dado A1", "Dado B1", "Dado C1"],
          ["Dado A2", "Dado B2", "Dado C2"],
          ["Dado A3", "Dado B3", "Dado C3"]
        ]
      }));
      saveProject();
      renderSlide();
      showToast("‚úÖ Tabela adicionada");
    }

    function addConclusion() {
      saveHistory();
      project.blocks.push(createBlock("conclusion", {
        title: "Conclus√£o",
        text: "Resumo dos principais pontos apresentados e considera√ß√µes finais sobre o tema abordado."
      }));
      saveProject();
      renderSlide();
      showToast("‚úÖ Conclus√£o adicionada");
    }

    function addJustification() {
      saveHistory();
      project.blocks.push(createBlock("justification", {
        title: "Justificativa",
        text: "Apresenta√ß√£o dos motivos e fundamentos que sustentam a proposta ou decis√£o apresentada."
      }));
      saveProject();
      renderSlide();
      showToast("‚úÖ Justificativa adicionada");
    }

    function addHighlight() {
      saveHistory();
      project.blocks.push(createBlock("highlight", {
        title: "Ponto de Destaque",
        text: "Informa√ß√£o importante que merece aten√ß√£o especial e destaque visual."
      }));
      saveProject();
      renderSlide();
      showToast("‚úÖ Destaque adicionado");
    }

    function addInfoBox() {
      saveHistory();
      project.blocks.push(createBlock("infobox", {
        title: "Informa√ß√£o Adicional",
        text: "Contexto complementar ou dados relevantes que enriquecem a apresenta√ß√£o."
      }));
      saveProject();
      renderSlide();
      showToast("‚úÖ Info Box adicionado");
    }

    // =========================
    // BLOCK OPS
    // =========================
    function removeSelectedBlock() {
      saveHistory();
      const id = project.selectedBlockId;
      if (!id) return;

      project.blocks = project.blocks.filter(b => b.id !== id);
      project.selectedBlockId = null;

      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast("üóëÔ∏è Bloco removido");
    }

    function duplicateSelectedBlock() {
      saveHistory();
      const b = getSelectedBlock();
      if (!b) return;

      const copy = createBlock(b.type, JSON.parse(JSON.stringify(b.data)));
      project.blocks.push(copy);
      project.selectedBlockId = copy.id;

      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast("‚ßâ Bloco duplicado");
    }

    function moveSelectedBlock(dir) {
      saveHistory();
      const id = project.selectedBlockId;
      if (!id) return;

      const idx = project.blocks.findIndex(b => b.id === id);
      if (idx < 0) return;

      const newIdx = idx + dir;
      if (newIdx < 0 || newIdx >= project.blocks.length) return;

      const temp = project.blocks[idx];
      project.blocks[idx] = project.blocks[newIdx];
      project.blocks[newIdx] = temp;

      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast(dir < 0 ? "‚Üë Movido para cima" : "‚Üì Movido para baixo");
    }

    // =========================
    // RENDER
    // =========================
    function renderSlide() {
      const slide = document.getElementById("slide");
      slide.innerHTML = "";

      if (!project.blocks.length) {
        const empty = document.createElement("div");
        empty.className = "empty";
        empty.innerHTML = `
          <div class="empty-icon">üì¶</div>
          <h3>Nenhum bloco adicionado</h3>
          <p>Use a sidebar para adicionar componentes como Hero, Cards, Timeline e muito mais.</p>
        `;
        slide.appendChild(empty);
        return;
      }

      project.blocks.forEach(block => {
        const el = renderBlock(block);
        slide.appendChild(el);
      });
    }

    function renderBlock(block) {
      const wrapper = document.createElement("div");
      wrapper.className = "block";
      wrapper.setAttribute("draggable", "true");
      wrapper.dataset.blockId = block.id;
      
      if (block.id === project.selectedBlockId) wrapper.classList.add("selected");

      // Drag handle
      const handle = document.createElement("div");
      handle.className = "drag-handle";
      handle.innerHTML = "‚ãÆ‚ãÆ";
      wrapper.appendChild(handle);

      // Drag events
      wrapper.addEventListener("dragstart", handleDragStart);
      wrapper.addEventListener("dragend", handleDragEnd);
      wrapper.addEventListener("dragover", handleDragOver);
      wrapper.addEventListener("drop", handleDrop);
      wrapper.addEventListener("dragenter", handleDragEnter);
      wrapper.addEventListener("dragleave", handleDragLeave);

      wrapper.addEventListener("click", (e) => {
        e.stopPropagation();
        setSelectedBlock(block.id);
      });

      let content;
      switch (block.type) {
        case "hero": content = renderHero(block.data); break;
        case "cards": content = renderCards(block.data); break;
        case "list": content = renderList(block.data); break;
        case "quote": content = renderQuote(block.data); break;
        case "timeline": content = renderTimeline(block.data); break;
        case "stats": content = renderStats(block.data); break;
        case "imagetext": content = renderImageText(block.data); break;
        case "cta": content = renderCTA(block.data); break;
        case "table": content = renderTable(block.data); break;
        case "conclusion": content = renderConclusion(block.data); break;
        case "justification": content = renderJustification(block.data); break;
        case "highlight": content = renderHighlight(block.data); break;
        case "infobox": content = renderInfoBox(block.data); break;
        default:
          content = document.createElement("div");
          content.textContent = "Bloco desconhecido";
      }

      wrapper.appendChild(content);
      return wrapper;
    }

    // =========================
    // DRAG AND DROP
    // =========================
    let draggedBlock = null;

    function handleDragStart(e) {
      draggedBlock = this;
      this.classList.add("dragging");
      e.dataTransfer.effectAllowed = "move";
      e.dataTransfer.setData("text/html", this.innerHTML);
    }

    function handleDragEnd(e) {
      this.classList.remove("dragging");
      document.querySelectorAll(".block").forEach(block => {
        block.classList.remove("drag-over");
      });
    }

    function handleDragOver(e) {
      if (e.preventDefault) {
        e.preventDefault();
      }
      e.dataTransfer.dropEffect = "move";
      return false;
    }

    function handleDragEnter(e) {
      if (this !== draggedBlock) {
        this.classList.add("drag-over");
      }
    }

    function handleDragLeave(e) {
      this.classList.remove("drag-over");
    }

    function handleDrop(e) {
      if (e.stopPropagation) {
        e.stopPropagation();
      }

      if (draggedBlock !== this) {
        saveHistory();
        
        const draggedId = draggedBlock.dataset.blockId;
        const targetId = this.dataset.blockId;
        
        const draggedIdx = project.blocks.findIndex(b => b.id === draggedId);
        const targetIdx = project.blocks.findIndex(b => b.id === targetId);
        
        if (draggedIdx !== -1 && targetIdx !== -1) {
          const draggedBlockData = project.blocks[draggedIdx];
          project.blocks.splice(draggedIdx, 1);
          
          const newTargetIdx = project.blocks.findIndex(b => b.id === targetId);
          project.blocks.splice(newTargetIdx, 0, draggedBlockData);
          
          saveProject();
          renderSlide();
          renderPropertiesPanel();
          showToast("‚úÖ Bloco reposicionado");
        }
      }

      return false;
    }

    function renderHero(data) {
      const div = document.createElement("div");
      div.className = "hero";
      div.innerHTML = `
        <h1>${escapeHtml(data.title || "")}</h1>
        <p>${escapeHtml(data.subtitle || "")}</p>
      `;
      return div;
    }

    function renderCards(data) {
      const div = document.createElement("div");
      div.className = "cards";
      
      const leftColor = data.left?.color || "#4ADE80";
      const rightColor = data.right?.color || "#6B7280";
      
      div.innerHTML = `
        <div class="card" style="background: linear-gradient(135deg, ${leftColor}, ${adjustColor(leftColor, -20)});">
          <h2>${escapeHtml(data.left?.title || "")}</h2>
          <p>${escapeHtml(data.left?.text || "")}</p>
        </div>
        <div class="card" style="background: linear-gradient(135deg, ${rightColor}, ${adjustColor(rightColor, -20)});">
          <h2>${escapeHtml(data.right?.title || "")}</h2>
          <p>${escapeHtml(data.right?.text || "")}</p>
        </div>
      `;
      return div;
    }

    function renderList(data) {
      const div = document.createElement("div");
      div.className = "list-section";
      const items = Array.isArray(data.items) ? data.items : [];
      div.innerHTML = `
        <h2>${escapeHtml(data.title || "")}</h2>
        <ul>
          ${items.map(i => `<li>${escapeHtml(i || "")}</li>`).join("")}
        </ul>
      `;
      return div;
    }

    function renderQuote(data) {
      const div = document.createElement("div");
      div.className = "quote";
      div.innerHTML = `
        <blockquote>"${escapeHtml(data.text || "")}"</blockquote>
        <cite>‚Äî ${escapeHtml(data.author || "")}</cite>
      `;
      return div;
    }

    function renderTimeline(data) {
      const div = document.createElement("div");
      div.className = "timeline";
      const items = Array.isArray(data.items) ? data.items : [];
      
      let html = `<h2>${escapeHtml(data.title || "")}</h2>`;
      items.forEach(item => {
        html += `
          <div class="timeline-item">
            <div class="timeline-dot"></div>
            <div class="timeline-content">
              <h3>${escapeHtml(item.title || "")}</h3>
              <p>${escapeHtml(item.text || "")}</p>
            </div>
          </div>
        `;
      });
      
      div.innerHTML = html;
      return div;
    }

    function renderStats(data) {
      const div = document.createElement("div");
      div.className = "stats-grid";
      const stats = Array.isArray(data.stats) ? data.stats : [];
      
      div.innerHTML = stats.map(stat => `
        <div class="stat-card">
          <div class="stat-value">${escapeHtml(stat.value || "")}</div>
          <div class="stat-label">${escapeHtml(stat.label || "")}</div>
        </div>
      `).join("");
      
      return div;
    }

    function renderImageText(data) {
      const div = document.createElement("div");
      div.className = "image-text";
      
      const imgHTML = data.image 
        ? `<div class="image-text-img"><img src="${data.image}" alt="Imagem" /></div>`
        : `<div class="image-text-img">üñºÔ∏è</div>`;
      
      const textHTML = `
        <div class="image-text-content">
          <h2>${escapeHtml(data.title || "")}</h2>
          <p>${escapeHtml(data.text || "")}</p>
        </div>
      `;
      
      div.innerHTML = data.imagePosition === "right" ? textHTML + imgHTML : imgHTML + textHTML;
      return div;
    }

    function renderCTA(data) {
      const div = document.createElement("div");
      div.className = "cta";
      div.innerHTML = `
        <h2>${escapeHtml(data.title || "")}</h2>
        <p>${escapeHtml(data.text || "")}</p>
        <a href="#" class="cta-button" onclick="event.preventDefault()">${escapeHtml(data.buttonText || "")}</a>
      `;
      return div;
    }

    function renderTable(data) {
      const div = document.createElement("div");
      div.className = "table-wrapper";
      
      const headers = Array.isArray(data.headers) ? data.headers : [];
      const rows = Array.isArray(data.rows) ? data.rows : [];
      
      let html = `<h2>${escapeHtml(data.title || "")}</h2>`;
      html += `<table class="simple-table">`;
      html += `<thead><tr>`;
      headers.forEach(h => html += `<th>${escapeHtml(h || "")}</th>`);
      html += `</tr></thead><tbody>`;
      
      rows.forEach(row => {
        html += `<tr>`;
        (Array.isArray(row) ? row : []).forEach(cell => {
          html += `<td>${escapeHtml(cell || "")}</td>`;
        });
        html += `</tr>`;
      });
      
      html += `</tbody></table>`;
      div.innerHTML = html;
      return div;
    }

    function renderConclusion(data) {
      const div = document.createElement("div");
      div.className = "conclusion";
      div.innerHTML = `
        <h2>${escapeHtml(data.title || "")}</h2>
        <p>${escapeHtml(data.text || "")}</p>
      `;
      return div;
    }

    function renderJustification(data) {
      const div = document.createElement("div");
      div.className = "justification";
      div.innerHTML = `
        <h2>${escapeHtml(data.title || "")}</h2>
        <p>${escapeHtml(data.text || "")}</p>
      `;
      return div;
    }

    function renderHighlight(data) {
      const div = document.createElement("div");
      div.className = "highlight";
      div.innerHTML = `
        <h2>${escapeHtml(data.title || "")}</h2>
        <p>${escapeHtml(data.text || "")}</p>
      `;
      return div;
    }

    function renderInfoBox(data) {
      const div = document.createElement("div");
      div.className = "info-box";
      div.innerHTML = `
        <h2>${escapeHtml(data.title || "")}</h2>
        <p>${escapeHtml(data.text || "")}</p>
      `;
      return div;
    }

    // Clique fora: deseleciona
    document.addEventListener("click", (e) => {
      const inPreview = e.target.closest(".slide");
      const inBlock = e.target.closest(".block");
      if (inPreview && !inBlock) {
        project.selectedBlockId = null;
        saveProject();
        renderSlide();
        renderPropertiesPanel();
      }
    });

    // =========================
    // PROPERTIES PANEL
    // =========================
    function renderPropertiesPanel() {
      const container = document.getElementById("propertiesSection");
      const panelHost = container.querySelector(".panel");
      const b = getSelectedBlock();

      if (!b) {
        panelHost.innerHTML = `<div class="muted">Selecione um bloco no preview para editar.</div>`;
        return;
      }

      panelHost.innerHTML = `
        <div class="panel-top">
          <div class="panel-badge">${labelForType(b.type)}</div>
          <div class="panel-actions">
            <button class="icon-btn" title="Subir" onclick="moveSelectedBlock(-1)">‚Üë</button>
            <button class="icon-btn" title="Descer" onclick="moveSelectedBlock(1)">‚Üì</button>
            <button class="icon-btn" title="Duplicar" onclick="duplicateSelectedBlock()">‚ßâ</button>
            <button class="icon-btn" title="Remover" onclick="removeSelectedBlock()">‚úï</button>
          </div>
        </div>
        ${renderFieldsForBlock(b)}
      `;
    }

    function renderFieldsForBlock(block) {
      const t = block.type;

      if (t === "hero") {
        return `
          <div class="field">
            <label>T√≠tulo</label>
            <input class="input" value="${escapeAttr(block.data.title || "")}"
              oninput="updateSelectedData('title', this.value)" />
          </div>
          <div class="field">
            <label>Subt√≠tulo</label>
            <input class="input" value="${escapeAttr(block.data.subtitle || "")}"
              oninput="updateSelectedData('subtitle', this.value)" />
          </div>
        `;
      }

      if (t === "cards") {
        return `
          <div class="field">
            <label>Card Esquerdo ‚Äî T√≠tulo</label>
            <input class="input" value="${escapeAttr(block.data.left?.title || "")}"
              oninput="updateSelectedNested('left','title', this.value)" />
          </div>
          <div class="field">
            <label>Card Esquerdo ‚Äî Texto</label>
            <textarea class="textarea"
              oninput="updateSelectedNested('left','text', this.value)">${escapeHtml(block.data.left?.text || "")}</textarea>
          </div>
          <div class="field">
            <label>Card Esquerdo ‚Äî Cor</label>
            <input type="color" class="color-input" value="${block.data.left?.color || "#4ADE80"}"
              oninput="updateSelectedNested('left','color', this.value)" />
          </div>
          <div class="field">
            <label>Card Direito ‚Äî T√≠tulo</label>
            <input class="input" value="${escapeAttr(block.data.right?.title || "")}"
              oninput="updateSelectedNested('right','title', this.value)" />
          </div>
          <div class="field">
            <label>Card Direito ‚Äî Texto</label>
            <textarea class="textarea"
              oninput="updateSelectedNested('right','text', this.value)">${escapeHtml(block.data.right?.text || "")}</textarea>
          </div>
          <div class="field">
            <label>Card Direito ‚Äî Cor</label>
            <input type="color" class="color-input" value="${block.data.right?.color || "#6B7280"}"
              oninput="updateSelectedNested('right','color', this.value)" />
          </div>
        `;
      }

      if (t === "list") {
        const items = Array.isArray(block.data.items) ? block.data.items : [];
        return `
          <div class="field">
            <label>T√≠tulo</label>
            <input class="input" value="${escapeAttr(block.data.title || "")}"
              oninput="updateSelectedData('title', this.value)" />
          </div>
          <div class="field">
            <label>Itens (um por linha)</label>
            <textarea class="textarea"
              oninput="updateListItemsFromTextarea(this.value)">${escapeHtml(items.join("\n"))}</textarea>
          </div>
        `;
      }

      if (t === "quote") {
        return `
          <div class="field">
            <label>Cita√ß√£o</label>
            <textarea class="textarea"
              oninput="updateSelectedData('text', this.value)">${escapeHtml(block.data.text || "")}</textarea>
          </div>
          <div class="field">
            <label>Autor</label>
            <input class="input" value="${escapeAttr(block.data.author || "")}"
              oninput="updateSelectedData('author', this.value)" />
          </div>
        `;
      }

      if (t === "timeline") {
        const items = Array.isArray(block.data.items) ? block.data.items : [];
        return `
          <div class="field">
            <label>T√≠tulo</label>
            <input class="input" value="${escapeAttr(block.data.title || "")}"
              oninput="updateSelectedData('title', this.value)" />
          </div>
          <div class="timeline-manager">
            ${items.map((item, idx) => `
              <div class="timeline-item-editor">
                <div class="timeline-item-header">
                  <div class="timeline-item-number">Fase ${idx + 1}</div>
                  <div class="timeline-item-actions">
                    ${idx > 0 ? `<button class="mini-btn" onclick="moveTimelineItem(${idx}, -1)" title="Mover para cima">‚Üë</button>` : ''}
                    ${idx < items.length - 1 ? `<button class="mini-btn" onclick="moveTimelineItem(${idx}, 1)" title="Mover para baixo">‚Üì</button>` : ''}
                    <button class="mini-btn danger" onclick="removeTimelineItem(${idx})" title="Remover">‚úï</button>
                  </div>
                </div>
                <div class="field">
                  <input class="input" placeholder="T√≠tulo da fase" value="${escapeAttr(item.title || "")}"
                    oninput="updateTimelineItemField(${idx}, 'title', this.value)" />
                </div>
                <div class="field">
                  <textarea class="textarea" placeholder="Descri√ß√£o da fase"
                    oninput="updateTimelineItemField(${idx}, 'text', this.value)">${escapeHtml(item.text || "")}</textarea>
                </div>
              </div>
            `).join('')}
            <button class="add-timeline-item-btn" onclick="addTimelineItem()">
              <span>+</span> Adicionar Fase
            </button>
          </div>
        `;
      }

      if (t === "stats") {
        const stats = Array.isArray(block.data.stats) ? block.data.stats : [];
        return `
          <div class="stats-manager">
            ${stats.map((stat, idx) => `
              <div class="stat-item-editor">
                <div class="stat-item-header">
                  <div class="stat-item-number">Estat√≠stica ${idx + 1}</div>
                  <div class="timeline-item-actions">
                    ${idx > 0 ? `<button class="mini-btn" onclick="moveStatItem(${idx}, -1)" title="Mover para cima">‚Üë</button>` : ''}
                    ${idx < stats.length - 1 ? `<button class="mini-btn" onclick="moveStatItem(${idx}, 1)" title="Mover para baixo">‚Üì</button>` : ''}
                    <button class="mini-btn danger" onclick="removeStatItem(${idx})" title="Remover">‚úï</button>
                  </div>
                </div>
                <div class="stat-fields">
                  <div class="field">
                    <input class="input" placeholder="Valor (ex: 10K+)" value="${escapeAttr(stat.value || "")}"
                      oninput="updateStatItemField(${idx}, 'value', this.value)" />
                  </div>
                  <div class="field">
                    <input class="input" placeholder="Label (ex: Clientes)" value="${escapeAttr(stat.label || "")}"
                      oninput="updateStatItemField(${idx}, 'label', this.value)" />
                  </div>
                </div>
              </div>
            `).join('')}
            <button class="add-timeline-item-btn" onclick="addStatItem()">
              <span>+</span> Adicionar Estat√≠stica
            </button>
          </div>
        `;
      }

      if (t === "imagetext") {
        return `
          <div class="field">
            <label>Imagem</label>
            ${renderImageUploadField(block.data.image, 'image')}
          </div>
          <div class="field">
            <label>T√≠tulo</label>
            <input class="input" value="${escapeAttr(block.data.title || "")}"
              oninput="updateSelectedData('title', this.value)" />
          </div>
          <div class="field">
            <label>Texto</label>
            <textarea class="textarea"
              oninput="updateSelectedData('text', this.value)">${escapeHtml(block.data.text || "")}</textarea>
          </div>
          <div class="field">
            <label>Posi√ß√£o da Imagem</label>
            <select class="select" onchange="updateSelectedData('imagePosition', this.value)">
              <option value="left" ${block.data.imagePosition === "left" ? "selected" : ""}>Esquerda</option>
              <option value="right" ${block.data.imagePosition === "right" ? "selected" : ""}>Direita</option>
            </select>
          </div>
        `;
      }

      if (t === "cta") {
        return `
          <div class="field">
            <label>T√≠tulo</label>
            <input class="input" value="${escapeAttr(block.data.title || "")}"
              oninput="updateSelectedData('title', this.value)" />
          </div>
          <div class="field">
            <label>Texto</label>
            <textarea class="textarea"
              oninput="updateSelectedData('text', this.value)">${escapeHtml(block.data.text || "")}</textarea>
          </div>
          <div class="field">
            <label>Texto do Bot√£o</label>
            <input class="input" value="${escapeAttr(block.data.buttonText || "")}"
              oninput="updateSelectedData('buttonText', this.value)" />
          </div>
        `;
      }

      if (t === "table") {
        const headers = Array.isArray(block.data.headers) ? block.data.headers : [];
        const rows = Array.isArray(block.data.rows) ? block.data.rows : [];
        return `
          <div class="field">
            <label>T√≠tulo</label>
            <input class="input" value="${escapeAttr(block.data.title || "")}"
              oninput="updateSelectedData('title', this.value)" />
          </div>
          <div class="table-manager">
            <div class="table-header-editor">
              <div class="table-section-title">
                <span>üìã Cabe√ßalhos</span>
                <button class="mini-btn" onclick="addTableHeader()" title="Adicionar coluna">+</button>
              </div>
              <div class="table-headers-grid">
                ${headers.map((header, idx) => `
                  <div class="table-header-item">
                    <input class="input" placeholder="Nome da coluna ${idx + 1}" value="${escapeAttr(header || "")}"
                      oninput="updateTableHeader(${idx}, this.value)" />
                    <button class="mini-btn danger" onclick="removeTableHeader(${idx})" title="Remover coluna">‚úï</button>
                  </div>
                `).join('')}
              </div>
            </div>
            
            <div class="table-section-title">
              <span>üìä Linhas de Dados</span>
            </div>
            
            ${rows.map((row, rowIdx) => `
              <div class="table-row-editor">
                <div class="table-row-header">
                  <div class="table-row-number">Linha ${rowIdx + 1}</div>
                  <div class="timeline-item-actions">
                    ${rowIdx > 0 ? `<button class="mini-btn" onclick="moveTableRow(${rowIdx}, -1)" title="Mover para cima">‚Üë</button>` : ''}
                    ${rowIdx < rows.length - 1 ? `<button class="mini-btn" onclick="moveTableRow(${rowIdx}, 1)" title="Mover para baixo">‚Üì</button>` : ''}
                    <button class="mini-btn danger" onclick="removeTableRow(${rowIdx})" title="Remover linha">‚úï</button>
                  </div>
                </div>
                <div class="table-cells-grid">
                  ${(Array.isArray(row) ? row : []).map((cell, cellIdx) => `
                    <div class="field">
                      <label>${headers[cellIdx] || `Coluna ${cellIdx + 1}`}</label>
                      <input class="input" value="${escapeAttr(cell || "")}"
                        oninput="updateTableCell(${rowIdx}, ${cellIdx}, this.value)" />
                    </div>
                  `).join('')}
                </div>
              </div>
            `).join('')}
            
            <button class="add-timeline-item-btn" onclick="addTableRow()">
              <span>+</span> Adicionar Linha
            </button>
          </div>
        `;
      }

      if (t === "conclusion" || t === "justification" || t === "highlight" || t === "infobox") {
        return `
          <div class="field">
            <label>T√≠tulo</label>
            <input class="input" value="${escapeAttr(block.data.title || "")}"
              oninput="updateSelectedData('title', this.value)" />
          </div>
          <div class="field">
            <label>Texto</label>
            <textarea class="textarea" style="min-height: 120px;"
              oninput="updateSelectedData('text', this.value)">${escapeHtml(block.data.text || "")}</textarea>
          </div>
        `;
      }

      return `<div class="muted">Sem propriedades para este bloco.</div>`;
    }

    // =========================
    // STATS MANAGER FUNCTIONS
    // =========================
    function addStatItem() {
      saveHistory();
      const b = getSelectedBlock();
      if (!b || b.type !== "stats") return;
      
      if (!Array.isArray(b.data.stats)) b.data.stats = [];
      b.data.stats.push({ value: "100+", label: "Nova M√©trica" });
      
      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast("‚úÖ Estat√≠stica adicionada");
    }

    function removeStatItem(idx) {
      saveHistory();
      const b = getSelectedBlock();
      if (!b || b.type !== "stats") return;
      
      if (Array.isArray(b.data.stats)) {
        b.data.stats.splice(idx, 1);
      }
      
      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast("üóëÔ∏è Estat√≠stica removida");
    }

    function moveStatItem(idx, direction) {
      saveHistory();
      const b = getSelectedBlock();
      if (!b || b.type !== "stats" || !Array.isArray(b.data.stats)) return;
      
      const newIdx = idx + direction;
      if (newIdx < 0 || newIdx >= b.data.stats.length) return;
      
      const temp = b.data.stats[idx];
      b.data.stats[idx] = b.data.stats[newIdx];
      b.data.stats[newIdx] = temp;
      
      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast(direction < 0 ? "‚Üë Estat√≠stica movida para cima" : "‚Üì Estat√≠stica movida para baixo");
    }

    function updateStatItemField(idx, field, value) {
      const b = getSelectedBlock();
      if (!b || b.type !== "stats" || !Array.isArray(b.data.stats)) return;
      if (idx < 0 || idx >= b.data.stats.length) return;
      
      b.data.stats[idx][field] = value;
      saveProject();
      renderSlide();
    }

    // =========================
    // TABLE MANAGER FUNCTIONS
    // =========================
    function addTableHeader() {
      saveHistory();
      const b = getSelectedBlock();
      if (!b || b.type !== "table") return;
      
      if (!Array.isArray(b.data.headers)) b.data.headers = [];
      b.data.headers.push("Nova Coluna");
      
      // Adicionar c√©lula vazia em todas as linhas existentes
      if (Array.isArray(b.data.rows)) {
        b.data.rows.forEach(row => {
          if (Array.isArray(row)) {
            row.push("");
          }
        });
      }
      
      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast("‚úÖ Coluna adicionada");
    }

    function removeTableHeader(idx) {
      saveHistory();
      const b = getSelectedBlock();
      if (!b || b.type !== "table") return;
      
      if (Array.isArray(b.data.headers)) {
        b.data.headers.splice(idx, 1);
      }
      
      // Remover c√©lula correspondente de todas as linhas
      if (Array.isArray(b.data.rows)) {
        b.data.rows.forEach(row => {
          if (Array.isArray(row) && row.length > idx) {
            row.splice(idx, 1);
          }
        });
      }
      
      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast("üóëÔ∏è Coluna removida");
    }

    function updateTableHeader(idx, value) {
      const b = getSelectedBlock();
      if (!b || b.type !== "table" || !Array.isArray(b.data.headers)) return;
      if (idx < 0 || idx >= b.data.headers.length) return;
      
      b.data.headers[idx] = value;
      saveProject();
      renderSlide();
      renderPropertiesPanel();
    }

    function addTableRow() {
      saveHistory();
      const b = getSelectedBlock();
      if (!b || b.type !== "table") return;
      
      if (!Array.isArray(b.data.rows)) b.data.rows = [];
      const numColumns = Array.isArray(b.data.headers) ? b.data.headers.length : 3;
      const newRow = Array(numColumns).fill("");
      b.data.rows.push(newRow);
      
      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast("‚úÖ Linha adicionada");
    }

    function removeTableRow(idx) {
      saveHistory();
      const b = getSelectedBlock();
      if (!b || b.type !== "table") return;
      
      if (Array.isArray(b.data.rows)) {
        b.data.rows.splice(idx, 1);
      }
      
      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast("üóëÔ∏è Linha removida");
    }

    function moveTableRow(idx, direction) {
      saveHistory();
      const b = getSelectedBlock();
      if (!b || b.type !== "table" || !Array.isArray(b.data.rows)) return;
      
      const newIdx = idx + direction;
      if (newIdx < 0 || newIdx >= b.data.rows.length) return;
      
      const temp = b.data.rows[idx];
      b.data.rows[idx] = b.data.rows[newIdx];
      b.data.rows[newIdx] = temp;
      
      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast(direction < 0 ? "‚Üë Linha movida para cima" : "‚Üì Linha movida para baixo");
    }

    function updateTableCell(rowIdx, cellIdx, value) {
      const b = getSelectedBlock();
      if (!b || b.type !== "table" || !Array.isArray(b.data.rows)) return;
      if (rowIdx < 0 || rowIdx >= b.data.rows.length) return;
      
      const row = b.data.rows[rowIdx];
      if (!Array.isArray(row)) return;
      
      // Garantir que a linha tem c√©lulas suficientes
      while (row.length <= cellIdx) {
        row.push("");
      }
      
      row[cellIdx] = value;
      saveProject();
      renderSlide();
    }

    // =========================
    // TIMELINE MANAGER FUNCTIONS
    // =========================
    function addTimelineItem() {
      saveHistory();
      const b = getSelectedBlock();
      if (!b || b.type !== "timeline") return;
      
      if (!Array.isArray(b.data.items)) b.data.items = [];
      b.data.items.push({ title: "Nova Fase", text: "Descri√ß√£o da fase" });
      
      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast("‚úÖ Fase adicionada");
    }

    function removeTimelineItem(idx) {
      saveHistory();
      const b = getSelectedBlock();
      if (!b || b.type !== "timeline") return;
      
      if (Array.isArray(b.data.items)) {
        b.data.items.splice(idx, 1);
      }
      
      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast("üóëÔ∏è Fase removida");
    }

    function moveTimelineItem(idx, direction) {
      saveHistory();
      const b = getSelectedBlock();
      if (!b || b.type !== "timeline" || !Array.isArray(b.data.items)) return;
      
      const newIdx = idx + direction;
      if (newIdx < 0 || newIdx >= b.data.items.length) return;
      
      const temp = b.data.items[idx];
      b.data.items[idx] = b.data.items[newIdx];
      b.data.items[newIdx] = temp;
      
      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast(direction < 0 ? "‚Üë Fase movida para cima" : "‚Üì Fase movida para baixo");
    }

    function updateTimelineItemField(idx, field, value) {
      const b = getSelectedBlock();
      if (!b || b.type !== "timeline" || !Array.isArray(b.data.items)) return;
      if (idx < 0 || idx >= b.data.items.length) return;
      
      b.data.items[idx][field] = value;
      saveProject();
      renderSlide();
    }

    function updateSelectedData(field, value) {
      const b = getSelectedBlock();
      if (!b) return;
      b.data[field] = value;
      saveProject();
      renderSlide();
    }

    function updateSelectedNested(side, field, value) {
      const b = getSelectedBlock();
      if (!b) return;
      if (!b.data[side]) b.data[side] = {};
      b.data[side][field] = value;
      saveProject();
      renderSlide();
    }

    function updateListItemsFromTextarea(text) {
      const b = getSelectedBlock();
      if (!b) return;
      const lines = text.split("\n").map(s => s.trim()).filter(Boolean);
      b.data.items = lines;
      saveProject();
      renderSlide();
    }

    function labelForType(type) {
      const labels = {
        hero: "Hero",
        cards: "Cards",
        list: "Lista",
        quote: "Quote",
        timeline: "Timeline",
        stats: "Stats",
        imagetext: "Imagem + Texto",
        cta: "CTA",
        table: "Tabela",
        conclusion: "Conclus√£o",
        justification: "Justificativa",
        highlight: "Destaque",
        infobox: "Info Box"
      };
      return labels[type] || "Bloco";
    }

    // =========================
    // IMAGE UPLOAD FUNCTIONS
    // =========================
    function renderImageUploadField(currentImage, fieldName) {
      const uploadId = 'upload-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
      
      window['handler_' + uploadId] = {
        click: () => document.getElementById(uploadId).click(),
        change: (e) => handleImageUpload(e.target, fieldName),
        remove: () => removeImage(fieldName)
      };
      
      if (currentImage) {
        setTimeout(() => {
          const input = document.getElementById(uploadId);
          const area = document.getElementById('upload-area-' + uploadId);
          const btnChange = document.getElementById('btn-change-' + uploadId);
          const btnRemove = document.getElementById('btn-remove-' + uploadId);
          
          if (input) input.onchange = window['handler_' + uploadId].change;
          if (area) area.onclick = window['handler_' + uploadId].click;
          if (btnChange) btnChange.onclick = (e) => { e.stopPropagation(); window['handler_' + uploadId].click(); };
          if (btnRemove) btnRemove.onclick = (e) => { e.stopPropagation(); window['handler_' + uploadId].remove(); };
        }, 10);
        
        return `
          <div class="image-upload-area has-image" id="upload-area-${uploadId}">
            <img src="${currentImage}" class="image-preview" />
          </div>
          <div class="image-actions">
            <button class="btn-small" type="button" id="btn-change-${uploadId}">
              Trocar Imagem
            </button>
            <button class="btn-small danger" type="button" id="btn-remove-${uploadId}">
              Remover
            </button>
          </div>
          <input type="file" id="${uploadId}" accept="image/*" style="display:none" />
        `;
      } else {
        setTimeout(() => {
          const input = document.getElementById(uploadId);
          const area = document.getElementById('upload-area-' + uploadId);
          
          if (input) input.onchange = window['handler_' + uploadId].change;
          if (area) area.onclick = window['handler_' + uploadId].click;
        }, 10);
        
        return `
          <div class="image-upload-area" id="upload-area-${uploadId}">
            <div class="upload-icon">üì∑</div>
            <div class="upload-placeholder">Clique para adicionar imagem</div>
          </div>
          <input type="file" id="${uploadId}" accept="image/*" style="display:none" />
        `;
      }
    }

    function handleImageUpload(input, fieldName) {
      const file = input.files[0];
      if (!file) return;

      if (!file.type.startsWith('image/')) {
        showToast("‚ùå Arquivo inv√°lido. Use imagens (JPG, PNG, etc)");
        return;
      }

      showToast("‚è≥ Processando imagem...");

      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          const canvas = document.createElement('canvas');
          let width = img.width;
          let height = img.height;
          
          const maxSize = 800;
          if (width > height) {
            if (width > maxSize) {
              height = (height * maxSize) / width;
              width = maxSize;
            }
          } else {
            if (height > maxSize) {
              width = (width * maxSize) / height;
              height = maxSize;
            }
          }
          
          canvas.width = width;
          canvas.height = height;
          
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, width, height);
          
          const compressedBase64 = canvas.toDataURL('image/jpeg', 0.8);
          
          saveHistory();
          const b = getSelectedBlock();
          if (!b) return;

          b.data[fieldName] = compressedBase64;
          saveProject();
          renderSlide();
          renderPropertiesPanel();
          showToast("‚úÖ Imagem adicionada!");
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function removeImage(fieldName) {
      saveHistory();
      const b = getSelectedBlock();
      if (!b) return;

      b.data[fieldName] = null;
      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast("üóëÔ∏è Imagem removida");
    }

    // =========================
    // CLEAR
    // =========================
    function clearAll() {
      if (!confirm("Limpar todo o conte√∫do? Esta a√ß√£o n√£o pode ser desfeita.")) return;
      saveHistory();
      project.blocks = [];
      project.selectedBlockId = null;
      saveProject();
      renderSlide();
      renderPropertiesPanel();
      showToast("üóëÔ∏è Tudo limpo");
    }

    // =========================
    // EXPORT PDF
    // =========================
    async function exportPDF() {
      const loading = document.getElementById("loading");
      const loadingText = document.getElementById("loadingText");
      loading.classList.add("active");
      loadingText.textContent = "Gerando PDF...";

      try {
        const slide = document.getElementById("slide");
        const prevSelected = project.selectedBlockId;
        const prevZoom = project.zoom;
        
        project.selectedBlockId = null;
        project.zoom = 1;
        applyZoom();
        renderSlide();

        await new Promise(r => setTimeout(r, 100));

        const canvas = await html2canvas(slide, {
          scale: 2,
          backgroundColor: "#ffffff",
          width: 1000,
          height: slide.scrollHeight
        });

        project.selectedBlockId = prevSelected;
        project.zoom = prevZoom;
        applyZoom();
        renderSlide();

        const { jsPDF } = window.jspdf;
        const imgWidth = 297;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        
        const pdf = new jsPDF({
          orientation: imgHeight > imgWidth ? "portrait" : "landscape",
          unit: "mm",
          format: "a4"
        });

        const imgData = canvas.toDataURL("image/png");
        pdf.addImage(imgData, "PNG", 0, 0, imgWidth, imgHeight);
        pdf.save("linkren-presentation.pdf");
        
        showToast("‚úÖ PDF exportado com sucesso!");
      } catch (e) {
        console.error(e);
        showToast("‚ùå Erro ao exportar PDF");
      } finally {
        loading.classList.remove("active");
      }
    }

    // =========================
    // EXPORT PPT
    // =========================
    function exportPPTFromData() {
      if (!project.blocks.length) {
        showToast("‚ö†Ô∏è N√£o h√° blocos para exportar");
        return;
      }

      const loading = document.getElementById("loading");
      const loadingText = document.getElementById("loadingText");
      loading.classList.add("active");
      loadingText.textContent = "Gerando PPT...";

      try {
        exportPPT(project);
        showToast("‚úÖ PPT exportado com sucesso!");
      } catch (e) {
        console.error(e);
        showToast("‚ùå Erro ao exportar PPT");
      } finally {
        loading.classList.remove("active");
      }
    }

    function exportPPT(projectData) {
      const pptx = new PptxGenJS();
      const theme = resolveThemeForPPT(projectData.theme);

      pptx.defineLayout({ name: "LINKREN", width: 13.33, height: 7.5 });
      pptx.layout = "LINKREN";

      projectData.blocks.forEach(block => {
        const slide = pptx.addSlide();
        slide.background = { fill: theme.background };

        switch (block.type) {
          case "hero": renderHeroSlide(slide, block.data, theme); break;
          case "cards": renderCardsSlide(slide, block.data, theme); break;
          case "list": renderListSlide(slide, block.data, theme); break;
          case "quote": renderQuoteSlide(slide, block.data, theme); break;
          case "timeline": renderTimelineSlide(slide, block.data, theme); break;
          case "stats": renderStatsSlide(slide, block.data, theme); break;
          case "imagetext": renderImageTextSlide(slide, block.data, theme); break;
          case "cta": renderCTASlide(slide, block.data, theme); break;
          case "table": renderTableSlide(slide, block.data, theme); break;
        }
      });

      pptx.writeFile({ fileName: "linkren-presentation.pptx" });
    }

    function resolveThemeForPPT(themeName) {
      if (themeName === "dark") {
        return { background: "0A0A0A", text: "FFFFFF", accent: "4ADE80", muted: "9CA3AF" };
      }
      if (themeName === "corporate") {
        return { background: "EFF6FF", text: "111827", accent: "3B82F6", muted: "6B7280" };
      }
      return { background: "FFFFFF", text: "111827", accent: "4ADE80", muted: "6B7280" };
    }

    function renderHeroSlide(slide, data, theme) {
      slide.addText(data.title || "", {
        x: 1.0, y: 2.5, w: 11.33, h: 1.5,
        fontSize: 44, bold: true, color: theme.text, align: "center"
      });
      slide.addText(data.subtitle || "", {
        x: 2.0, y: 4.2, w: 9.33, h: 1.0,
        fontSize: 20, color: theme.muted, align: "center"
      });
    }

    function renderCardsSlide(slide, data, theme) {
      const leftColor = (data.left?.color || "#4ADE80").replace("#", "");
      const rightColor = (data.right?.color || "#6B7280").replace("#", "");

      slide.addShape("rect", { x: 0.5, y: 1.5, w: 6.0, h: 4.5, fill: leftColor, round: 0.2 });
      slide.addText(data.left?.title || "", { 
        x: 0.8, y: 2.0, w: 5.4, h: 0.8, 
        fontSize: 28, bold: true, color: "FFFFFF", align: "center" 
      });
      slide.addText(data.left?.text || "", { 
        x: 0.8, y: 3.0, w: 5.4, h: 2.5, 
        fontSize: 16, color: "FFFFFF", align: "center", valign: "top"
      });

      slide.addShape("rect", { x: 6.83, y: 1.5, w: 6.0, h: 4.5, fill: rightColor, round: 0.2 });
      slide.addText(data.right?.title || "", { 
        x: 7.13, y: 2.0, w: 5.4, h: 0.8, 
        fontSize: 28, bold: true, color: "FFFFFF", align: "center" 
      });
      slide.addText(data.right?.text || "", { 
        x: 7.13, y: 3.0, w: 5.4, h: 2.5, 
        fontSize: 16, color: "FFFFFF", align: "center", valign: "top"
      });
    }

    function renderListSlide(slide, data, theme) {
      slide.addText(data.title || "", {
        x: 0.8, y: 0.6, w: 11.73, h: 1.0,
        fontSize: 36, bold: true, color: theme.text
      });

      const items = Array.isArray(data.items) ? data.items : [];
      const bulletRuns = items.map(t => ({ text: t, options: { bullet: { code: "2022" }, color: theme.text } }));

      slide.addText(bulletRuns, {
        x: 1.0, y: 2.0, w: 11.33, h: 5.0,
        fontSize: 18, color: theme.text, lineSpacingMultiple: 1.3
      });
    }

    function renderQuoteSlide(slide, data, theme) {
      slide.background = { fill: "1E3A2F" };
      slide.addText(`"${data.text || ""}"`, {
        x: 1.5, y: 2.2, w: 10.33, h: 2.0,
        fontSize: 28, bold: true, color: "FFFFFF", align: "center", valign: "middle"
      });
      slide.addText(`‚Äî ${data.author || ""}`, {
        x: 4.0, y: 4.8, w: 5.33, h: 0.6,
        fontSize: 16, color: "FFFFFF", align: "center"
      });
    }

    function renderTimelineSlide(slide, data, theme) {
      slide.addText(data.title || "", {
        x: 0.8, y: 0.6, w: 11.73, h: 1.0,
        fontSize: 36, bold: true, color: theme.text
      });

      const items = Array.isArray(data.items) ? data.items : [];
      let yPos = 2.0;
      
      items.forEach((item, idx) => {
        if (idx < 3) {
          slide.addShape("ellipse", { 
            x: 0.9, y: yPos, w: 0.15, h: 0.15, 
            fill: theme.accent 
          });
          
          slide.addText(item.title || "", {
            x: 1.3, y: yPos - 0.1, w: 10.5, h: 0.4,
            fontSize: 20, bold: true, color: theme.text
          });
          
          slide.addText(item.text || "", {
            x: 1.3, y: yPos + 0.35, w: 10.5, h: 0.8,
            fontSize: 15, color: theme.muted
          });
          
          yPos += 1.6;
        }
      });
    }

    function renderStatsSlide(slide, data, theme) {
      const stats = Array.isArray(data.stats) ? data.stats : [];
      const positions = [
        { x: 0.8, y: 1.5 },
        { x: 7.0, y: 1.5 },
        { x: 0.8, y: 4.2 },
        { x: 7.0, y: 4.2 }
      ];

      stats.forEach((stat, idx) => {
        if (idx < 4) {
          const pos = positions[idx];
          
          slide.addShape("rect", {
            x: pos.x, y: pos.y, w: 5.5, h: 2.3,
            fill: "F0FDF4", line: { color: theme.accent, width: 2 }, round: 0.15
          });
          
          slide.addText(stat.value || "", {
            x: pos.x, y: pos.y + 0.4, w: 5.5, h: 0.9,
            fontSize: 40, bold: true, color: theme.accent, align: "center"
          });
          
          slide.addText(stat.label || "", {
            x: pos.x, y: pos.y + 1.4, w: 5.5, h: 0.5,
            fontSize: 14, bold: true, color: theme.muted, align: "center"
          });
        }
      });
    }

    function renderImageTextSlide(slide, data, theme) {
      slide.addText(data.title || "", {
        x: 7.0, y: 2.0, w: 5.5, h: 0.8,
        fontSize: 32, bold: true, color: theme.text
      });
      
      slide.addText(data.text || "", {
        x: 7.0, y: 3.0, w: 5.5, h: 3.0,
        fontSize: 16, color: theme.muted, valign: "top"
      });
      
      if (data.image) {
        slide.addImage({
          data: data.image,
          x: 0.8, y: 1.8, w: 5.5, h: 3.9,
          sizing: { type: 'cover' }
        });
      } else {
        slide.addShape("rect", {
          x: 0.8, y: 1.8, w: 5.5, h: 3.9,
          fill: "E5E7EB", round: 0.15
        });
        
        slide.addText("üñºÔ∏è", {
          x: 0.8, y: 1.8, w: 5.5, h: 3.9,
          fontSize: 80, align: "center", valign: "middle"
        });
      }
    }

    function renderCTASlide(slide, data, theme) {
      slide.addShape("rect", {
        x: 1.5, y: 1.8, w: 10.33, h: 3.9,
        fill: theme.accent, round: 0.2
      });
      
      slide.addText(data.title || "", {
        x: 2.0, y: 2.3, w: 9.33, h: 1.0,
        fontSize: 40, bold: true, color: "FFFFFF", align: "center"
      });
      
      slide.addText(data.text || "", {
        x: 2.5, y: 3.5, w: 8.33, h: 0.7,
        fontSize: 18, color: "FFFFFF", align: "center"
      });
      
      slide.addShape("rect", {
        x: 5.0, y: 4.5, w: 3.33, h: 0.7,
        fill: "FFFFFF", round: 0.1
      });
      
      slide.addText(data.buttonText || "", {
        x: 5.0, y: 4.5, w: 3.33, h: 0.7,
        fontSize: 16, bold: true, color: theme.accent, align: "center", valign: "middle"
      });
    }

    function renderTableSlide(slide, data, theme) {
      slide.addText(data.title || "", {
        x: 0.8, y: 0.6, w: 11.73, h: 0.9,
        fontSize: 36, bold: true, color: theme.text
      });

      const headers = Array.isArray(data.headers) ? data.headers : [];
      const rows = Array.isArray(data.rows) ? data.rows : [];

      const tableData = [
        headers.map(h => ({ text: h || "", options: { bold: true, fill: "E8F5E9", color: theme.text } })),
        ...rows.map(row => 
          (Array.isArray(row) ? row : []).map(cell => ({ text: cell || "", options: { color: theme.text } }))
        )
      ];

      slide.addTable(tableData, {
        x: 0.8, y: 1.8, w: 11.73, h: 5.0,
        fontSize: 14,
        border: { pt: 1, color: "D1D5DB" },
        fill: "FFFFFF"
      });
    }

    // =========================
    // UTILS
    // =========================
    function adjustColor(hex, percent) {
      const num = parseInt(hex.replace("#", ""), 16);
      const r = Math.max(0, Math.min(255, (num >> 16) + percent));
      const g = Math.max(0, Math.min(255, ((num >> 8) & 0x00FF) + percent));
      const b = Math.max(0, Math.min(255, (num & 0x0000FF) + percent));
      return "#" + ((r << 16) | (g << 8) | b).toString(16).padStart(6, "0");
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function escapeAttr(str) {
      return escapeHtml(str).replaceAll("\n", " ");
    }

    // =========================
    // TOAST
    // =========================
    function showToast(message) {
      const existingToast = document.querySelector(".toast");
      if (existingToast) existingToast.remove();

      const toast = document.createElement("div");
      toast.className = "toast";
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => toast.remove(), 3000);
    }

    // =========================
    // KEYBOARD SHORTCUTS
    // =========================
    document.addEventListener("keydown", (e) => {
      // Ctrl+S: Save
      if (e.ctrlKey && (e.key === "s" || e.key === "S")) {
        e.preventDefault();
        saveProjectManual();
      }
      
      // Ctrl+Z: Undo
      if (e.ctrlKey && e.key === "z") {
        e.preventDefault();
        undoAction();
      }
      
      // Ctrl+Y: Redo
      if (e.ctrlKey && e.key === "y") {
        e.preventDefault();
        redoAction();
      }
      
      // Del: Remove selected
      if (e.key === "Delete" && project.selectedBlockId) {
        e.preventDefault();
        removeSelectedBlock();
      }
      
      // Ctrl+D: Duplicate
      if (e.ctrlKey && e.key === "d" && project.selectedBlockId) {
        e.preventDefault();
        duplicateSelectedBlock();
      }
    });

    // =========================
    // INIT
    // =========================
    window.addEventListener("load", () => {
      loadProject();
      syncThemeButtonsOnLoad();
      applyZoom();
      renderSlide();
      renderPropertiesPanel();
    });
  </script>
</body>
</html>
